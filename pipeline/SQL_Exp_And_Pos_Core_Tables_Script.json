{
	"name": "SQL_Exp_And_Pos_Core_Tables_Script",
	"properties": {
		"activities": [
			{
				"name": "Exposure And Position Core Tables Script",
				"type": "Script",
				"dependsOn": [],
				"policy": {
					"timeout": "7.00:00:00",
					"retry": 0,
					"retryIntervalInSeconds": 30,
					"secureOutput": false,
					"secureInput": false
				},
				"userProperties": [],
				"linkedServiceName": {
					"referenceName": "SqlServerArgent",
					"type": "LinkedServiceReference"
				},
				"typeProperties": {
					"scripts": [
						{
							"type": "NonQuery",
							"text": "/*==================================================================================================================*\r\n * Project:\t\tArgent\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t*\r\n * Purpose:\t\tCreate core tables that will feed in to Exposure and Position data marks\t\t\t\t\t\t\t*\r\n * Description:\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t*\r\n *\t\t1.1\t\tRaw tables pulled from the data warehouse are first checked to see whether there are multiple date\t*\r\n *\t\t\t\tstamps in the tables, if there are multiple then older date stamps are deleted and only the most\t*\r\n *\t\t\t\tcurrent date stamps data is kept in the table.\t\t\t\t\t\t\t\t\t\t\t\t\t\t*\r\n *\t\t1.2\t\t\"Core.Items\" table is created.\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t*\r\n *\t\t1.3\t\t\"Core.Organizations\" table is created.\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t*\r\n *\t\t1.4\t\t\"Core.Users\" table is created.\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t*\r\n *\t\t1.5\t\t\"Core.Suppliers\" table is created.\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t*\r\n *\t\t1.6\t\t\"Core.Locations\" table is created.\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t*\r\n *\t\t1.7\t\t\"Core.Parties\" table is created.\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t*\r\n *\t\t1.8\t\t\"Core.PurchaseCcontracts\" table is created.\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t*\r\n *\t\t1.9\t\t\"Core.PurchaseOrders\" table is created.\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t*\r\n *\t\t1.10\t\"Core.SalesContracts\" table is created.\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t*\r\n *\t\t1.11\t\"Core.SalesOrders_Fulfilled\" table is created.\t\t\t\t\t\t\t\t\t\t\t\t\t\t*\r\n *\t\t1.12\t\"Core.OnHandBalance\" table is created.\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t*\r\n *\t\t1.13\t\"Core.ReceivingTransactions\" table is created.\t\t\t\t\t\t\t\t\t\t\t\t\t\t*\r\n *\t\t1.14\t\"Core.FXRates\" table is created.\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t*\r\n *\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t*\r\n * Prerequisites: Import the oracle data daily into the raw tables\t\t\t \t\t\t\t\t\t\t\t\t\t*\r\n *\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t*\r\n * Outputs: Tables \"Core.Items\"; \"Core.Organizations\"; \"Core.Users\"; \"Core.Suppliers\"; \"Core.Locations\";\t\t\t*\r\n *\t\t\t\"Core.Parties\"; \"Core.PurchaseContracts\"; \"Core.PurchaseOrders\"; \"Core.SalesContracts\";\t\t\t\t\t*\r\n *\t\t\t\"Core.SalesOrders_Fulfilled\"; \"Core.OnHandBalance\"; \"Core.ReceivingTransactions\"; \"Core.FXRates\"\t\t*\r\n *\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t*\r\n * Impact: If any of the core tables are re-created,\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t*\r\n *\t\t   then the trade tables must be edited and data deleted before DataMarks.sql can be re-run\t\t\t\t\t*\r\n *\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t*\r\n * Date:        29/07/2022\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t*\r\n * Version:     1.0\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t*\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\r\n *==================================================================================================================*\r\n * Updates:\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t*\r\n * Date\t\t| Version | Author\t\t| Change made\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t*\r\n * -----------------------------------------------------------------------------------------------------------------*\r\n * --/--/-- |  1.-\t  |\t\t\t\t|\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t*\r\n *\t\t\t|\t\t  |\t\t\t\t|\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t*\r\n *==================================================================================================================*/\r\n \r\n\r\n/********************************************************************************************************\r\n\tStep 1.1:\tUpdate the raw tables with the current day's data, pulled from the data warehouse.\r\n********************************************************************************************************/\r\n\r\n\tDECLARE @DeleteTableStatement NVARCHAR(MAX)\r\n\tDECLARE Cur2 CURSOR READ_ONLY\r\n\tFOR\r\n\t\t\tSELECT  'Delete from [RAW].[' + TABLE_NAME + ']  where stamp <> (select distinct max(stamp) from [RAW].[' + TABLE_NAME + '])'\r\n\t\t\tFROM    INFORMATION_SCHEMA.TABLES\r\n\t\t\tWHERE   TABLE_SCHEMA = 'RAW'\r\n\t\t\t\t\tAND TABLE_TYPE = 'BASE TABLE' and TABLE_NAME like 'O.%'\r\n\r\n\r\n\tOPEN Cur2\r\n\tFETCH NEXT FROM Cur2 INTO @DeleteTableStatement\r\n\tWHILE @@FETCH_STATUS = 0\r\n\t\t  BEGIN\r\n\t\t\t\tPRINT 'Executing ' + @DeleteTableStatement\r\n\t\t\t\tEXECUTE sp_executesql @DeleteTableStatement\r\n\t\t\t\tFETCH NEXT FROM Cur2 INTO @DeleteTableStatement\r\n\t\t  END\r\n\tCLOSE Cur2\r\n\tDEALLOCATE Cur2\r\n\r\n/********************************************************************************************************\r\n\tStep 1.2:\tCreate core items table.\r\n\r\n\t\t\t\tCore.Items is built by joining the tables [RAW].[O.EGP_SYSTEM_ITEMS_B], \r\n\t\t\t\t[RAW].[O.EGP_SYSTEM_ITEMS_TL], [RAW].[O.EGP_ITEM_CAT_ASSIGNMENTS], [RAW].[O.EGP_CATEGORIES_B],\r\n\t\t\t\t[RAW].[O.EGP_CATEGORY_SETS_TL]\r\n\r\n\t\t\t\t[RAW].[O.EGP_CATEGORY_SETS_TL] is filtered for [CATEGORY_SET_NAME] = 'Argent Catalog'\r\n\r\n********************************************************************************************************/\r\n\r\n\tIF OBJECT_ID('[Core].[Items]','U') IS NOT NULL\r\n\t\tDROP TABLE [Core].[Items]\r\n\r\n\tSELECT\t\tCAST(ib.[INVENTORY_ITEM_ID] AS NVARCHAR(255))\t\t\t\t\tAS [Inventory Item ID]\r\n\t,\t\t\tCAST(ib.[ORGANIZATION_ID] AS NVARCHAR(255))\t\t\t\t\tAS [Organization ID]\r\n\t,\t\t\tCAST(ib.[ATTRIBUTE1] AS NVARCHAR(255))\t\t\t\t\t\tAS [European Waste Code]\r\n\t,\t\t\tCAST(ib.[ATTRIBUTE11] AS NVARCHAR(255))\t\t\t\t\tAS [Dutch Item Name]\r\n\t,\t\t\tCAST(ib.[ATTRIBUTE13] AS NVARCHAR(255))\t\t\t\t\tAS [FATOL]\r\n\t,\t\t\tCAST(ib.[ATTRIBUTE14] AS NVARCHAR(255))\t\t\t\t\tAS [ABP Category]\r\n\t,\t\t\tCAST(ib.[ATTRIBUTE15] AS NVARCHAR(255))\t\t\t\t\tAS [Nature of Commodity EN]\r\n\t,\t\t\tCAST(ib.[ATTRIBUTE18] AS NVARCHAR(255))\t\t\t\t\tAS [Nature of Commodity NL]\r\n\t,\t\t\tCAST(ib.[ATTRIBUTE19] AS NVARCHAR(255))\t\t\t\t\tAS [Treatment Type]\r\n\t,\t\t\tCAST(ib.[ATTRIBUTE21] AS NVARCHAR(255))\t\t\t\t\tAS [Basel Code]\r\n\t,\t\t\tCAST(ib.[ATTRIBUTE25] AS NVARCHAR(255))\t\t\t\t\tAS [Hazardous Material Description]\r\n\t,\t\t\tCAST(ib.[ATTRIBUTE7] AS NVARCHAR(255))\t\t\t\t\t\tAS [Waste Item]\r\n\t,\t\t\tCAST(ib.[ATTRIBUTE8] AS NVARCHAR(255))\t\t\t\t\t\tAS [ABP Item]\r\n\t,\t\t\tCAST(ib.[ATTRIBUTE9] AS NVARCHAR(255))\t\t\t\t\t\tAS [Sustainable Item]\r\n\t,\t\t\tCAST(LEFT(ib.[CREATION_DATE],10) AS DATE)\t\tAS [Item Creation Date]\r\n\t,\t\t\tCAST(ib.[INVENTORY_ITEM_STATUS_CODE] AS NVARCHAR(255))\t\t\t\t\tAS [Item Status]\r\n\t,\t\t\tCAST(ib.[ITEM_NUMBER] AS NVARCHAR(255))\t\t\t\t\t\t\t\tAS [Item Code]\r\n\t,\t\t\tCAST(ib.[ITEM_TYPE] AS NVARCHAR(255))\t\t\t\t\t\t\t\t\tAS [Item Type]\r\n\t,\t\t\tCAST(LEFT(ib.[LAST_UPDATE_DATE],10) AS DATE)\tAS [Item Update Date]\r\n\t,\t\t\tCAST(ib.[PRIMARY_UOM_CODE] AS NVARCHAR(255))\t\t\t\t\t\t\tAS [Unit Of Measure]\r\n\t,\t\t\tCAST(it.[LANGUAGE] AS NVARCHAR(255))\t\t\t\t\t\t\t\t\tAS [Language]\r\n\t,\t\t\tCAST(it.[DESCRIPTION]\t AS NVARCHAR(255))\t\t\t\t\t\t\tAS [Item Name]\r\n\t,\t\t\tCAST(it.[LONG_DESCRIPTION] AS NVARCHAR(255))\t\t\t\t\t\t\tAS [Long Item Name]\r\n\t,\t\t\tCAST(cat.[ITEM_CATEGORY_ASSIGNMENT_ID] AS NVARCHAR(255))\t\t\t\tAS [Item Category Assignment ID]\r\n\t,\t\t\tCAST(cat.[CATEGORY_ID] AS NVARCHAR(255))\t\t\t\t\t\t\t\tAS [Category ID]\r\n\t,\t\t\tCAST(cat.[CATEGORY_CONTENT_CODE] AS NVARCHAR(255))\t\t\t\t\t\tAS [Category Content Code]\r\n\t,\t\t\tCAST(cat.[CATEGORY_CODE] AS NVARCHAR(255))\t\t\t\t\t\t\t\tAS [Category Code]\r\n\t,\t\t\tCAST(cat.[CATEGORY_SET_ID] AS NVARCHAR(255))\t\t\t\t\t\t\tAS [Category Set ID]\r\n\t,\t\t\tCAST(cat.[CATEGORY_SET_NAME] AS NVARCHAR(255))\t\t\t\t\t\t\tAS [Category Set Name]\r\n\t,\t\t\tCAST(cat.[DESCRIPTION] AS NVARCHAR(255))\t\t\t\t\t\t\t\tAS [Category Set Description]\r\n\tINTO\t\t[Core].[Items]\r\n\tFROM\t\t[RAW].[O.EGP_SYSTEM_ITEMS_B] ib\r\n\tLEFT JOIN\t[RAW].[O.EGP_SYSTEM_ITEMS_TL] it\r\n\tON\t\t\tib.[INVENTORY_ITEM_ID] = it.[INVENTORY_ITEM_ID]\r\n\tAND\t\t\tib.[ORGANIZATION_ID] = it.[ORGANIZATION_ID]\r\n\tLEFT JOIN\t(\r\n\t\t\t\t\tSELECT\t\t[ITEM_CATEGORY_ASSIGNMENT_ID]\t\r\n\t\t\t\t\t,\t\t\t[INVENTORY_ITEM_ID]\r\n\t\t\t\t\t,\t\t\t[ORGANIZATION_ID]\r\n\t\t\t\t\t,\t\t\tica.[CATEGORY_ID]\t\t\t\t\t\r\n\t\t\t\t\t,\t\t\t[CATEGORY_CONTENT_CODE]\t\t\t\r\n\t\t\t\t\t,\t\t\t[CATEGORY_CODE]\t\t\t\t\t\r\n\t\t\t\t\t,\t\t\tica.[CATEGORY_SET_ID]\t\t\t\t\r\n\t\t\t\t\t,\t\t\t[CATEGORY_SET_NAME]\t\t\t\t\r\n\t\t\t\t\t,\t\t\t[DESCRIPTION]\t\t\t\t\t\r\n\t\t\t\t\tFROM\t\t[RAW].[O.EGP_ITEM_CAT_ASSIGNMENTS] ica  \r\n\t\t\t\t\tLEFT JOIN\t[RAW].[O.EGP_CATEGORIES_B] cb\r\n\t\t\t\t\tON\t\t\tica.[CATEGORY_ID] = cb.[CATEGORY_ID] \r\n\t\t\t\t\tLEFT JOIN\t[RAW].[O.EGP_CATEGORY_SETS_TL] ct\r\n\t\t\t\t\tON\t\t\tica.[CATEGORY_SET_ID] = ct.[CATEGORY_SET_ID]\r\n\t\t\t\t\tWHERE\t\tct.[CATEGORY_SET_NAME] = 'Argent Catalog'\r\n\t\t\t\t) cat\r\n\tON\t\t\tcat.[INVENTORY_ITEM_ID] = ib.[INVENTORY_ITEM_ID]\r\n\r\n\r\n\t\r\n\r\n/********************************************************************************************************\r\n\tStep 1.3:\tCreate core organizations table.\r\n\r\n\t\t\t\tCore.Organizations is built by joining the tables [RAW].[O.[RAW].[O.INV_ORGANIZATION_DEFINITIONS_V]], \r\n\t\t\t\tand [RAW].[O.XLE_ENTITY_PROFILES]\r\n\t\t\t\t\r\n********************************************************************************************************/\r\n\r\n\tIF OBJECT_ID('[Core].[Organizations]','U') IS NOT NULL\r\n\t\tDROP TABLE [Core].[Organizations]\r\n\t\t\r\n\tSELECT\t\tCAST(o.[ORGANIZATION_ID] AS NVARCHAR(255))\t\t\t\t\t\t\tAS [Organization ID]\r\n\t,\t\t\tCAST(o.[ORGANIZATION_CODE] AS NVARCHAR(255))\t\t\t\t\t\tAS [Inventory Organization Code]\r\n\t,\t\t\tCAST(o.[ORGANIZATION_NAME] AS NVARCHAR(255))\t\t\t\t\t\tAS [Inventory Organization Name]\r\n\t,\t\t\tCAST(o.[SET_OF_BOOKS_ID] AS NVARCHAR(255))\t\t\t\t\t\t\tAS [Set Of Books ID]\r\n\t,\t\t\tCAST(o.[CHART_OF_ACCOUNTS_ID] AS NVARCHAR(255))\t\t\t\t\tAS [Chart Of Accounts ID]\r\n\t,\t\t\tCAST(o.[CURRENCY_CODE] AS NVARCHAR(255))\t\t\t\t\t\t\tAS [Currency Code]\r\n\t,\t\t\tCAST(o.[BUSINESS_UNIT_NAME]\t AS NVARCHAR(255))\t\t\t\t\tAS [Business Unit Name]\r\n\t,\t\t\tCAST(o.[BUSINESS_UNIT_ID] AS NVARCHAR(255))\t\t\t\t\t\tAS [Business Unit ID]\r\n\t,\t\t\tCAST(o.[INVENTORY_FLAG]\t AS NVARCHAR(255))\t\t\t\t\t\tAS [Inventory Flag]\r\n\t,\t\t\tCAST(o.[LOCATION_ID] AS NVARCHAR(255))\t\t\t\t\t\t\t\tAS [Location ID]\r\n\t,\t\t\tCAST(o.[TIMEZONE_CODE] AS NVARCHAR(255))\t\t\t\t\t\t\tAS [Timezone Code]\r\n\t,\t\t\tCAST(ISNULL(le.[LEGAL_ENTITY_ID],'N/A') AS NVARCHAR(255))\t\t\tAS [Legal Entity ID]\r\n\t,\t\t\tCAST(ISNULL(le.[PARTY_ID],'N/A') AS NVARCHAR(255))\t\t\t\t\tAS [Party ID]\r\n\t,\t\t\tCAST(ISNULL(le.[LEGAL_ENTITY_IDENTIFIER],'N/A') AS NVARCHAR(255))\tAS [Legal Entity Short Name]\r\n\t,\t\t\tCAST(ISNULL(le.[NAME],'N/A') AS NVARCHAR(255))\t\t\t\t\t\tAS [Legal Entity Name]\r\n\t,\t\t\tCAST(ISNULL(le.[GEOGRAPHY_ID],'N/A') AS NVARCHAR(255))\t\t\t\tAS [Geography ID]\r\n\t,\t\t\tCAST(ISNULL(le.[ATTRIBUTE_CATEGORY],'N/A') AS NVARCHAR(255))\t\tAS [Legal Entity Country]\r\n\tINTO\t\t[Core].[Organizations]\r\n\tFROM\t\t[RAW].[O.INV_ORGANIZATION_DEFINITIONS_V] o\r\n\tLEFT JOIN\t[RAW].[O.XLE_ENTITY_PROFILES] le\r\n\tON\t\t\to.[LEGAL_ENTITY] = le.LEGAL_ENTITY_ID\r\n\t\r\n\r\n/********************************************************************************************************\r\n\tStep 1.4:\tCreate core users table.\r\n\r\n\t\t\t\tCore.Users using the [RAW].[O.PER_USERS] table\r\n********************************************************************************************************/\r\n\r\n\tIF OBJECT_ID('[Core].[Users]','U') IS NOT NULL\r\n\t\tDROP TABLE [Core].[Users]\r\n\t\t\r\n\tSELECT\t\tCAST([USER_ID] AS NVARCHAR(255))\t\t\t\t\t\t\tAS [User ID]\r\n\t,\t\t\tCAST(LEFT([START_DATE],10) AS DATE)\tAS [Start Date]\r\n\t,\t\t\tCAST([USERNAME] AS NVARCHAR(255))\t\t\t\t\t\t\tAS [Username]\r\n\t,\t\t\tCAST([SUSPENDED] AS NVARCHAR(255))\t\t\t\t\t\t\tAS [Suspended]\r\n\t,\t\t\tCAST([PERSON_ID] AS NVARCHAR(255))\t\t\t\t\t\t\tAS [Person ID]\r\n\tINTO\t\t[Core].[Users]\r\n\tFROM\t\t[RAW].[O.PER_USERS] \r\n\r\n\r\n/********************************************************************************************************\r\n\tStep 1.5:\tCreate core suppliers table.\r\n\r\n\t\t\t\tCore.Suppliers is built by joining the tables [RAW].[O.POZ_SUPPLIERS]\r\n\t\t\t\tand [RAW].[O.POZ_SUPPLIER_SITES_ALL_M]\r\n********************************************************************************************************/\r\n\r\n\tIF OBJECT_ID('[Core].[Suppliers]','U') IS NOT NULL\r\n\t\tDROP TABLE [Core].[Suppliers]\r\n\r\n\tSELECT\t\tCAST(s.[VENDOR_ID] AS NVARCHAR(255))\t\t\t\t\t\tAS [Vendor ID]\r\n\t,\t\t\tCAST(s.[SEGMENT1] AS NVARCHAR(255))\t\t\t\t\t\tAS [Supplier ID]\r\n\t,\t\t\tCAST(s.[PARTY_ID] AS NVARCHAR(255))\t\t\t\t\t\tAS [Party ID]\r\n\t,\t\t\tCAST(s.[ORGANIZATION_TYPE_LOOKUP_CODE] AS NVARCHAR(255))\tAS [Organization Type]\r\n\t,\t\t\tCAST(s.[VENDOR_TYPE_LOOKUP_CODE] AS NVARCHAR(255))\t\t\tAS [Supplier Type]\r\n\t,\t\t\tLEFT(s.[END_DATE_ACTIVE],10)\t\tAS [Supplier Inactive Date]\r\n\t,\t\t\tCAST(ss.[VENDOR_SITE_ID] AS NVARCHAR(255))\t\t\t\t\tAS [Vendor Site ID]\r\n\t,\t\t\tCAST(ss.[PRC_BU_ID] AS NVARCHAR(255))\t\t\t\t\t\tAS [Prc BU ID]\r\n\t,\t\t\tCAST(ss.[LOCATION_ID] AS NVARCHAR(255))\t\t\t\t\tAS [Location ID]\t\r\n\t,\t\t\tCAST(ss.[PARTY_SITE_ID] AS NVARCHAR(255))\t\t\t\t\tAS [Party Site ID]\r\n\t,\t\t\tCAST(ss.[VENDOR_SITE_CODE] AS NVARCHAR(255))\t\t\t\tAS [Supplier Site Name] \r\n\t,\t\t\tCAST(ss.[PURCHASING_SITE_FLAG] AS NVARCHAR(255))\t\t\tAS [Purchasing Site Flag]\r\n\t,\t\t\tCAST(ss.[PAY_SITE_FLAG] AS NVARCHAR(255))\t\t\t\t\tAS [Pay Site Flag]\r\n\t,\t\t\tCAST(ss.[TERMS_ID] AS NVARCHAR(255))\t\t\t\t\t\tAS [Terms ID]\r\n\t,\t\t\tCAST(ss.[INVOICE_CURRENCY_CODE] AS NVARCHAR(255))\t\t\tAS [Site Invoice Currency Code]\r\n\t,\t\t\tCAST(ss.[PAYMENT_CURRENCY_CODE] AS NVARCHAR(255))\t\t\tAS [Site Payment Currency Code]\r\n\t,\t\t\tLEFT(ss.[INACTIVE_DATE],10)\t\t\tAS [Site Inactive Date]\t\t\t\t\t\r\n\t,\t\t\tCAST(ss.[ATTRIBUTE17] AS NVARCHAR(255))\t\t\t\t\tAS [VIHB Code]\t\r\n\t,\t\t\tCAST(ss.[ATTRIBUTE18] AS NVARCHAR(255))\t\t\t\t\tAS [Vendor Category]\t\r\n\t,\t\t\tCAST(ss.[ATTRIBUTE2] AS NVARCHAR(255))\t\t\t\t\t\tAS [ISCC Cetificate Number]\t\r\n\t,\t\t\tLEFT(ss.[ATTRIBUTE_DATE1],10)\t\tAS [ISCC Certificate Expiry Date]\r\n\t,\t\t\tCAST(ss.[ATTRIBUTE1] AS NVARCHAR(255))\t\t\t\t\t\tAS [Site VET ID]\r\n\t,\t\t\tCAST(ss.[ATTRIBUTE19] AS NVARCHAR(255))\t\t\t\t\tAS [INS Certificate Number]\r\n\t,\t\t\tLEFT(ss.[ATTRIBUTE_DATE2],10)\t\tAS [INS Certificate Expiry Date]\t\t\t\t\r\n\t,\t\t\tCAST(ss.[TERMS_DATE_BASIS] AS NVARCHAR(255))\t\t\t\tAS [Site Terms Date Basis]\r\n\tINTO\t\t[Core].[Suppliers]\r\n\tFROM\t\t[RAW].[O.POZ_SUPPLIERS] s\r\n\tLEFT JOIN\t[RAW].[O.POZ_SUPPLIER_SITES_ALL_M] ss\r\n\tON\t\t\ts.[VENDOR_ID] = ss.[VENDOR_ID]\r\n\r\n\r\n/********************************************************************************************************\r\n\tStep 1.6:\tCreate core locations table.\r\n\r\n\t\t\t\tCore.Locations is built using the [RAW].[O.HZ_LOCATIONS] table\r\n********************************************************************************************************/\r\n\r\n\tIF OBJECT_ID('[Core].[Locations]','U') IS NOT NULL\r\n\t\tDROP TABLE [Core].[Locations]\r\n\r\n\tSELECT\t\tCAST([LOCATION_ID] AS NVARCHAR(255))\t\t\t\tAS [Location ID]\r\n\t,\t\t\tCAST([Country] AS NVARCHAR(255))\t\t\t\t\tAS [Country]\r\n\t,\t\t\tCAST([ADDRESS1]\t AS NVARCHAR(255))\t\t\t\tAS [Company Name]\r\n\t,\t\t\tCAST([ADDRESS2]\t AS NVARCHAR(255))\t\t\t\tAS [Address Line 2]\r\n\t,\t\t\tCAST([CITY]\t AS NVARCHAR(255))\t\t\t\t\tAS [City]\r\n\t,\t\t\tCAST([POSTAL_CODE] AS NVARCHAR(255))\t\t\t\tAS [Postal Code]\r\n\t,\t\t\tCAST([ADDRESS_STYLE] AS NVARCHAR(255))\t\t\t\tAS [Address Style]\r\n\t,\t\t\tCAST([STATUS_FLAG] AS NVARCHAR(255))\t\t\t\tAS [Status Flag]\r\n\t,\t\t\tCAST([ADDRESS3] AS NVARCHAR(255))\t\t\t\t\tAS [Address Line 3]\r\n\t,\t\t\tCAST([ADDRESS4] AS NVARCHAR(255))\t\t\t\t\tAS [Address Line 4]\r\n\t,\t\t\tCAST([STATE] AS NVARCHAR(255))\t\t\t\t\t\tAS [State]\r\n\t,\t\t\tCAST([Province] AS NVARCHAR(255))\t\t\t\t\tAS [Province]\r\n\t,\t\t\tCAST([ADDR_ELEMENT_ATTRIBUTE2] AS NVARCHAR(255))\tAS [Area]\r\n\t,\t\t\tCAST([BUILDING] AS NVARCHAR(255))\t\t\t\t\tAS [Building Name]\r\n\tINTO\t\t[Core].[Locations]\r\n\tFROM\t\t[RAW].[O.HZ_LOCATIONS]\r\n\t\r\n\r\n/********************************************************************************************************\r\n\tStep 1.7:\tCreate core parties table.\r\n\r\n\t\t\t\tCore.Parties is built by joining the tables [RAW].[O.HZ_PARTIES]\r\n\t\t\t\tand [RAW].[O.HZ_PARTY_SITES]\r\n\r\n********************************************************************************************************/\r\n\r\n\tIF OBJECT_ID('[Core].[Parties]','U') IS NOT NULL\r\n\t\tDROP TABLE [Core].[Parties]\r\n\r\n\tSELECT\t\tCAST(p.[PARTY_ID] AS NVARCHAR(255))\t\t\t\tAS [Party ID]\r\n\t,\t\t\tCAST(p.[PARTY_NUMBER] AS NVARCHAR(255))\t\t\tAS [Party Number]\r\n\t,\t\t\tCAST(p.[PARTY_NAME] AS NVARCHAR(255))\t\t\t\tAS [Party Name]\r\n\t,\t\t\tCAST(p.[PARTY_TYPE] AS NVARCHAR(255))\t\t\t\tAS [Party Type]\r\n\t,\t\t\tCAST(p.[STATUS] AS NVARCHAR(255))\t\t\t\t\tAS [Party Status]\r\n\t,\t\t\tCAST(p.[INTERNAL_FLAG] AS NVARCHAR(255))\t\t\tAS [Internal Party]\r\n\t,\t\t\tCAST(p.[EMAIL_ADDRESS] AS NVARCHAR(255))\t\t\tAS [Party Email Address]\r\n\t,\t\t\tCAST(p.[DUNS_NUMBER_C] AS NVARCHAR(255))\t\t\tAS [DUNS Number]\r\n\t,\t\t\tCAST(ps.[PARTY_SITE_ID] AS NVARCHAR(255))\t\t\tas [Party SIte ID]\r\n\t,\t\t\tCAST(ps.[LOCATION_ID] AS NVARCHAR(255))\t\t\tAS [Location ID]\r\n\t,\t\t\tCAST(ps.[START_DATE_ACTIVE] AS NVARCHAR(255))\t\tAS [Start Date Active]\r\n\t,\t\t\tCAST(ps.[END_DATE_ACTIVE] AS NVARCHAR(255))\t\tAS [End Date Active]\r\n\t,\t\t\tCAST(ps.[PARTY_SITE_NUMBER] AS NVARCHAR(255))\t\tAS [Party Site Number]\r\n\t,\t\t\tCAST(ps.[STATUS] AS NVARCHAR(255))\t\t\t\t\tAS [Party Site Status]\r\n\t,\t\t\tCAST(ps.[PARTY_SITE_NAME] AS NVARCHAR(255))\t\tAS [Party Site Name]\r\n\t,\t\t\tCAST(ps.[OVERALL_PRIMARY_FLAG] AS NVARCHAR(255))\tAS [Primary Party Site]\r\n\tINTO\t\t[Core].[Parties]\r\n\tFROM\t\t[RAW].[O.HZ_PARTIES] p\r\n\tLEFT JOIN\t[RAW].[O.HZ_PARTY_SITES] ps\t\t\r\n\tON\t\t\tp.[PARTY_ID] = ps.[PARTY_ID]\r\n\r\n\r\n/********************************************************************************************************\r\n\tStep 1.8:\tCreate core purchase contracts table.\r\n\r\n\t\t\t\tCore.PurchaseContracts is built by joining the tables [RAW].[O.PO_HEADERS_ALL],\r\n\t\t\t\t[RAW].[O.PO_LINES_ALL] and [RAW].[O.PO_GA_ORG_ASSIGNMENTS]\r\n\r\n\t\t\t\t[RAW].[O.PO_HEADERS_ALL] is filtered for [TYPE_LOOKUP_CODE] = 'BLANKET'\r\n\r\n\t\t\t\t[Blanket Agreement Quantity] is calculated as ([BLANKET_TOTAL_AMOUNT] - 10)/[UNIT_PRICE]\r\n\t\t\t\tif [QUANTITY_COMMITTED] is NULL. Otherwise it is set to [QUANTITY_COMMITTED]\r\n********************************************************************************************************/\r\n\r\n\r\n\tIF OBJECT_ID('[Core].[PurchaseContracts]','U') IS NOT NULL\r\n\t\tDROP TABLE [Core].[PurchaseContracts]\r\n\t\t\r\n\tSELECT\t\tCAST(pha.[PO_HEADER_ID] AS NVARCHAR(255))\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tAS [PO Header ID]\t\t\t\t\r\n\t,\t\t\tCAST(pha.[CURRENT_VERSION_ID] AS NVARCHAR(255))\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tAS [Current Version ID]\r\n\t,\t\t\tCAST(pha.[DOCUMENT_STATUS] AS NVARCHAR(255))\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tAS [Purchase Document Status]\r\n\t,\t\t\tCAST(pha.[PRC_BU_ID] AS NVARCHAR(255))\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tAS [Purchasing BU]\r\n\t,\t\t\tCAST(pha.[AGENT_ID] AS NVARCHAR(255))\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tAS [Buyer]\r\n\t,\t\t\tCAST(pha.[TYPE_LOOKUP_CODE]\t AS NVARCHAR(255))\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tAS [Purchase Document Type]\r\n\t,\t\t\tCAST(pha.[SEGMENT1] AS NVARCHAR(255))\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tAS [Blanket Purchase Agreement Number]\r\n\t,\t\t\tCAST(pha.[VENDOR_ID] AS NVARCHAR(255))\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tAS [Supplier]\r\n\t,\t\t\tCAST(pha.[VENDOR_SITE_ID] AS NVARCHAR(255))\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tAS [Supplier Site]\r\n\t,\t\t\tCAST(pha.[TERMS_ID] AS NVARCHAR(255))\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tAS [Terms ID]\r\n\t,\t\t\tCAST(pha.[FREIGHT_TERMS_LOOKUP_CODE] AS NVARCHAR(255))\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tAS [Incoterm]\r\n\t,\t\t\tCAST(pha.[CURRENCY_CODE] AS NVARCHAR(255))\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tAS [Purchase Document Currency]\t\r\n\t,\t\t\tCAST(LEFT(pha.[START_DATE],10) AS NVARCHAR(255))\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tAS [Agreement Start Date]\t\t\t\r\n\t,\t\t\tCAST(LEFT(pha.[END_DATE],10) AS NVARCHAR(255))\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tAS [Agreement End Date]\t\t\r\n\t,\t\t\tCAST(pha.[BLANKET_TOTAL_AMOUNT]\t AS NVARCHAR(255))\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tAS [Agreement Amount]\r\n\t,\t\t\tCAST(CASE WHEN pha.[AMOUNT_RELEASED] IS NULL THEN '0' ELSE pha.[AMOUNT_RELEASED] END AS NUMERIC(28,2))\t\t\tAS [Amount Released Against Agreement]\t\r\n\t,\t\t\tCAST(pha.[CARRIER_ID] AS NVARCHAR(255))\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tAS [Carrier ID]\t\t\t\r\n\t,\t\t\tCAST(pha.[NOTE_TO_VENDOR] AS NVARCHAR(255))\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tAS [Note To Vendor]\t\r\n\t,\t\t\tCAST(pha.[BILLTO_BU_ID]\t AS NVARCHAR(255))\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tAS [Bill To BU ID]\r\n\t,\t\t\tCAST(pha.[SOLDTO_LE_ID]\t AS NVARCHAR(255))\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tAS [Sold To BU ID]\r\n\t,\t\t\tCAST(pha.[REQ_BU_ID] AS NVARCHAR(255))\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tAS [Req BU ID]\r\n\t,\t\t\tCAST(pha.[SHIP_TO_LOCATION_ID] AS NVARCHAR(255))\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tAS [Ship To Location ID]\r\n\t,\t\t\tCAST(pha.[BILL_TO_LOCATION_ID] AS NVARCHAR(255))\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tAS [Bill To Location ID]\r\n\t,\t\t\tCAST(LEFT(pha.[CLOSED_DATE],10) AS NVARCHAR(255))\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tAS [Purchased Document Closed Date]\t\t\t\t\t\t\r\n\t,\t\t\tCAST(pha.[RATE]\t\t AS NVARCHAR(255))\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tAS [Currency Conversion Rate]\t\r\n\t,\t\t\tCAST(pha.[NOTE_TO_RECEIVER]\t AS NVARCHAR(255))\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tAS [Note To Receiver]\r\n\t,\t\t\tCAST(pha.[COMMENTS]\t\t AS NVARCHAR(255))\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tAS [Purchase Document Description]\t\t\r\n\t,\t\t\tCAST(pha.[FROM_HEADER_ID]\t AS NVARCHAR(255))\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tAS [From Header ID]\r\n\t,\t\t\tCAST(pha.[FROM_TYPE_LOOKUP_CODE]\t AS NVARCHAR(255))\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tAS [From Type Lookup Code]\r\n\t,\t\t\tCAST(pha.[FOB_LOOKUP_CODE]\t\t AS NVARCHAR(255))\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tAS [Sustainability Position]\t\t\t\r\n\t,\t\t\tCAST(LEFT(pha.[ATTRIBUTE_DATE1],10)\t\t AS NVARCHAR(255))\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tAS [Deal Date]\t\t\r\n\t,\t\t\tCAST(pha.[ATTRIBUTE5]\t AS NVARCHAR(255))\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tAS [Transporter Name]\t\r\n\t,\t\t\tCAST(CASE WHEN pha.[ATTRIBUTE_NUMBER2] IS NULL THEN '0' ELSE pha.[ATTRIBUTE_NUMBER2] END AS NUMERIC(28,2))\t\tAS [Transporter Unit Price]\t\r\n\t,\t\t\tCAST(pha.[ATTRIBUTE9] AS NVARCHAR(255))\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tAS [FFA Spec]\t\t\t\t\r\n\t,\t\t\tCAST(CASE WHEN pha.[ATTRIBUTE_NUMBER3] IS NULL THEN '0' ELSE pha.[ATTRIBUTE_NUMBER3] END AS NUMERIC(28,2))\t\tAS [Transporter Amount]\t\t\r\n\t,\t\t\tCAST(pha.[ATTRIBUTE18] AS NVARCHAR(255))\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tAS [Ultimo Order]\t\t\r\n\t,\t\t\tCAST(pha.[ATTRIBUTE12]\t AS NVARCHAR(255))\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tAS [Transporter Currency]\t\r\n\t,\t\t\tCAST(pha.[ATTRIBUTE7] AS NVARCHAR(255))\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tAS [Additional Charges 1 Supplier]\t\r\n\t,\t\t\tCAST(CASE WHEN pha.[ATTRIBUTE_NUMBER4] IS NULL THEN '0' ELSE pha.[ATTRIBUTE_NUMBER4] END AS NUMERIC(28,2))\t\tAS [Additional Charges 1 Unit Price]\r\n\t,\t\t\tCAST(CASE WHEN pha.[ATTRIBUTE_NUMBER5] IS NULL THEN '0' ELSE pha.[ATTRIBUTE_NUMBER5] END AS NUMERIC(28,2))\t\tAS [Additional Charges 1 Amount]\r\n\t,\t\t\tCAST(pha.[ATTRIBUTE13] AS NVARCHAR(255))\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tAS [Additional Charges 1 Currency]\r\n\t,\t\t\tCAST(pha.[ATTRIBUTE17] AS NVARCHAR(255))\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tAS [Additional Charges 1 Description]\r\n\t,\t\t\tCAST(pha.[ATTRIBUTE12]\t AS NVARCHAR(255))\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tAS [Additional Charges 2 Supplier]\r\n\t,\t\t\tCAST(CASE WHEN pha.[ATTRIBUTE_NUMBER6] IS NULL THEN '0' ELSE pha.[ATTRIBUTE_NUMBER6] END AS NUMERIC(28,2))\t\tAS [Additional Charges 2 Unit Price]\r\n\t--,\t\t\tCAST(CASE WHEN pha.[ATTRIBUTE_NUMBER7] IS NULL THEN '0' ELSE pha.[ATTRIBUTE_NUMBER7] END AS NUMERIC(28,2))\t\tAS [Additional Charges 2 Amount]\r\n\t,\t\t\tNULL\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tAS [Additional Charges 2 Amount]\r\n\t,\t\t\tCAST(pha.[ATTRIBUTE15] AS NVARCHAR(255))\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tAS [Additional Charges 2 Currency]\r\n\t,\t\t\tCAST(pla.[PO_LINE_ID] AS NVARCHAR(255))\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tAS [PO Line ID]\r\n\t,\t\t\tCAST(pla.[LINE_STATUS] AS NVARCHAR(255))\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tAS [Line Status]\r\n\t,\t\t\tCAST(pla.[LINE_NUM]\t AS NVARCHAR(255))\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tAS [Line NUmber]\r\n\t,\t\t\tCAST(pla.[ITEM_ID] AS NVARCHAR(255))\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tAS [Item ID]\r\n\t,\t\t\tCAST(pla.[CATEGORY_ID]\t AS NVARCHAR(255))\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tAS [Category ID]\r\n\t,\t\t\tCAST(pla.[ITEM_DESCRIPTION]\t AS NVARCHAR(255))\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tAS [Item Description]\r\n\t,\t\t\tCAST(pla.[UOM_CODE]\t AS NVARCHAR(255))\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tAS [UOM Code]\r\n\t,\t\t\tCAST(pla.[UNIT_PRICE] AS NUMERIC(28,2))\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tAS [Unit Price]\r\n\t,\t\t\tCAST(pla.[QUANTITY] AS NVARCHAR(255))\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tAS [Ordered Quantity]\r\n\t,\t\t\tCAST(pla.[FROM_LINE_ID]\t AS NVARCHAR(255))\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tAS [From Line ID]\r\n\t,\t\t\tCAST(pla.[VENDOR_PRODUCT_NUM] AS NVARCHAR(255))\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tAS [Supplier Item]\r\n\t,\t\t\tCASE\r\n\t\t\t\t\tWHEN CAST(pla.[UNIT_PRICE] AS NUMERIC(28,2)) = 0\r\n\t\t\t\t\t\tTHEN 0\r\n\t\t\t\t\tWHEN pla.[QUANTITY_COMMITTED] IS NULL\r\n\t\t\t\t\t\tTHEN CAST(CASE \r\n\t\t\t\t\t\t\t\t\tWHEN pha.[BLANKET_TOTAL_AMOUNT] IS NULL\r\n\t\t\t\t\t\t\t\t\t\tTHEN '0' \r\n\t\t\t\t\t\t\t\t\tELSE CAST(pha.[BLANKET_TOTAL_AMOUNT] AS NUMERIC(28,2)) - 10\r\n\t\t\t\t\t\t\t\t  END AS NUMERIC(28,2))/CAST(pla.[UNIT_PRICE] AS NUMERIC(28,2))\r\n\t\t\t\t\tELSE CAST(pla.[QUANTITY_COMMITTED] AS NUMERIC(28,2))\r\n\t\t\t\tEND\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tAS [Blanket Agreement Quantity]\t\r\n\t,\t\t\tCAST(pla.[CLOSED_DATE] AS NVARCHAR(255))\t\tAS [CLOSED_DATE]\r\n\t,\t\t\tCAST(pla.[CANCEL_REASON] AS NVARCHAR(255))\t\tAS [CANCEL_REASON]\r\n\t,\t\t\tCAST(poa.[Vendor Site ID] AS NVARCHAR(255))\t\tAS [Vendor Site ID]\r\n\tINTO\t\t[Core].[PurchaseContracts]\r\n\tFROM\t\t[RAW].[O.PO_HEADERS_ALL] pha\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\r\n\tLEFT JOIN\t[RAW].[O.PO_LINES_ALL] pla\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\r\n\tON\t\t\tpla.[PO_HEADER_ID] = pha.[PO_HEADER_ID]\r\n\tLEFT JOIN\t(\r\n\t\t\t\t\tSELECT\t\t[PO_HEADER_ID]\t\r\n\t\t\t\t\t,\t\t\tMIN([VENDOR_SITE_ID]) AS [Vendor Site ID]\r\n\t\t\t\t\tFROM\t\t[RAW].[O.PO_GA_ORG_ASSIGNMENTS]\r\n\t\t\t\t\tGROUP BY\t[PO_HEADER_ID]\r\n\t\t\t\t) poa\r\n\tON\t\t\tpha.[PO_HEADER_ID] = poa.[PO_HEADER_ID]\r\n\tWHERE\t\tpha.[TYPE_LOOKUP_CODE] = 'BLANKET'\r\n\r\n\r\n/********************************************************************************************************\r\n\tStep 1.9:\tCreate core purchase orders table.\r\n\r\n\t\t\t\tCore.PurchaseOrders is built by joining the tables [RAW].[O.PO_HEADERS_ALL],\r\n\t\t\t\tand [RAW].[O.PO_LINES_ALL]\r\n\r\n\t\t\t\t[RAW].[O.PO_HEADERS_ALL] is filtered for [TYPE_LOOKUP_CODE] = 'STANDARD'\r\n\r\n********************************************************************************************************/\r\n\tIF OBJECT_ID('[Core].[PurchaseOrders]','U') IS NOT NULL\r\n\t\tDROP TABLE [Core].[PurchaseOrders]\r\n\t\t\r\n\tSELECT\t\tCAST(pha.[PO_HEADER_ID] AS NVARCHAR(255))\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tAS [PO Header ID]\t\t\t\t\r\n\t,\t\t\tCAST(pha.[CURRENT_VERSION_ID] AS NVARCHAR(255))\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tAS [Current Version ID]\r\n\t,\t\t\tCAST(pha.[DOCUMENT_STATUS] AS NVARCHAR(255))\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tAS [Purchase Document Status]\r\n\t,\t\t\tCAST(pha.[PRC_BU_ID] AS NVARCHAR(255))\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tAS [Purchasing BU]\r\n\t,\t\t\tCAST(pha.[AGENT_ID] AS NVARCHAR(255))\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tAS [Buyer]\r\n\t,\t\t\tCAST(pha.[TYPE_LOOKUP_CODE]\t AS NVARCHAR(255))\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tAS [Purchase Document Type]\r\n\t,\t\t\tCAST(pha.[SEGMENT1] AS NVARCHAR(255))\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tAS [Purchase Order Number]\r\n\t,\t\t\tCAST(pha.[VENDOR_ID] AS NVARCHAR(255))\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tAS [Supplier]\r\n\t,\t\t\tCAST(pha.[VENDOR_SITE_ID] AS NVARCHAR(255))\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tAS [Supplier Site]\r\n\t,\t\t\tCAST(pha.[TERMS_ID]\t AS NVARCHAR(255))\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tAS [Terms ID]\r\n\t,\t\t\tCAST(pha.[FREIGHT_TERMS_LOOKUP_CODE] AS NVARCHAR(255))\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tAS [Incoterm]\r\n\t,\t\t\tCAST(pha.[CURRENCY_CODE] AS NVARCHAR(255))\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tAS [Purchase Document Currency]\t\r\n\t,\t\t\tCAST(LEFT(pha.[START_DATE],10) AS NVARCHAR(255))\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tAS [Agreement Start Date]\t\t\t\r\n\t,\t\t\tCAST(LEFT(pha.[END_DATE],10) AS NVARCHAR(255))\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tAS [Agreement End Date]\t\t\r\n\t,\t\t\tCAST(pha.[BLANKET_TOTAL_AMOUNT]\t AS NVARCHAR(255))\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tAS [Agreement Amount]\r\n\t,\t\t\tCAST(pha.[AMOUNT_RELEASED] AS NVARCHAR(255))\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tAS [Amount Released Against Agreement]\t\r\n\t,\t\t\tCAST(pha.[CARRIER_ID] AS NVARCHAR(255))\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tAS [Carrier ID]\t\t\t\r\n\t,\t\t\tCAST(pha.[NOTE_TO_VENDOR] AS NVARCHAR(255))\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tAS [Note To Vendor]\t\r\n\t,\t\t\tCAST(pha.[BILLTO_BU_ID]\t AS NVARCHAR(255))\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tAS [Bill To BU ID]\r\n\t,\t\t\tCAST(pha.[SOLDTO_LE_ID] AS NVARCHAR(255))\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tAS [Sold To BU ID]\r\n\t,\t\t\tCAST(pha.[REQ_BU_ID] AS NVARCHAR(255))\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tAS [Req BU ID]\r\n\t,\t\t\tCAST(pha.[SHIP_TO_LOCATION_ID] AS NVARCHAR(255))\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tAS [Ship To Location ID]\r\n\t,\t\t\tCAST(pha.[BILL_TO_LOCATION_ID] AS NVARCHAR(255))\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tAS [Bill To Location ID]\r\n\t,\t\t\tCAST(LEFT(pha.[CLOSED_DATE],10) AS NVARCHAR(255))\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tAS [Purchased Document Closed Date]\t\t\t\t\t\t\r\n\t,\t\t\tCAST(pha.[RATE] AS NVARCHAR(255))\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tAS [Currency Conversion Rate]\t\r\n\t,\t\t\tCAST(pha.[NOTE_TO_RECEIVER]\t AS NVARCHAR(255))\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tAS [Note To Receiver]\r\n\t,\t\t\tCAST(pha.[COMMENTS] AS NVARCHAR(255))\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tAS [Purchase Document Description]\t\t\r\n\t,\t\t\tCAST(pha.[FROM_TYPE_LOOKUP_CODE] AS NVARCHAR(255))\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tAS [From Type Lookup Code]\r\n\t,\t\t\tCAST(pha.[FOB_LOOKUP_CODE] AS NVARCHAR(255))\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tAS [Sustainability Position]\t\t\t\r\n\t,\t\t\tCAST(LEFT(pha.[ATTRIBUTE_DATE1],10)\t AS NVARCHAR(255))\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tAS [Deal Date]\t\t\r\n\t,\t\t\tCAST(pha.[ATTRIBUTE5] AS NVARCHAR(255))\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tAS [Transporter Name]\t\r\n\t,\t\t\tCAST(pha.[ATTRIBUTE_NUMBER2] AS NVARCHAR(255))\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tAS [Transporter Unit Price]\t\r\n\t,\t\t\tCAST(pha.[ATTRIBUTE9] AS NVARCHAR(255))\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tAS [FFA Spec]\t\t\t\t\r\n\t,\t\t\tCAST(pha.[ATTRIBUTE_NUMBER3] AS NVARCHAR(255))\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tAS [Transporter Amount]\t\t\r\n\t,\t\t\tCAST(pha.[ATTRIBUTE18] AS NVARCHAR(255))\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tAS [Ultimo Order]\t\t\r\n\t,\t\t\tCAST(pha.[ATTRIBUTE12] AS NVARCHAR(255))\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tAS [Transporter Currency]\t\t\r\n\t,\t\t\tCAST(pha.[ATTRIBUTE7] AS NVARCHAR(255))\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tAS [Additional Charges 1 Supplier]\t\r\n\t,\t\t\tCAST(pha.[ATTRIBUTE_NUMBER4] AS NVARCHAR(255))\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tAS [Additional Charges 1 Unit Price]\r\n\t,\t\t\tCAST(pha.[ATTRIBUTE_NUMBER5] AS NVARCHAR(255))\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tAS [Additional Charges 1 Amount]\r\n\t,\t\t\tCAST(pha.[ATTRIBUTE13] AS NVARCHAR(255))\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tAS [Additional Charges 1 Currency]\r\n\t,\t\t\tCAST(pha.[ATTRIBUTE17] AS NVARCHAR(255))\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tAS [Additional Charges 1 Description]\r\n\t,\t\t\tCAST(pha.[ATTRIBUTE12] AS NVARCHAR(255))\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tAS [Additional Charges 2 Supplier]\r\n\t,\t\t\tCAST(pha.[ATTRIBUTE_NUMBER6] AS NVARCHAR(255))\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tAS [Additional Charges 2 Unit Price]\r\n\t--,\t\t\tpha.[ATTRIBUTE_NUMBER7]\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tAS [Additional Charges 2 Amount]\r\n\t,\t\t\tNULL\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tAS [Additional Charges 2 Amount]\r\n\t,\t\t\tCAST(pha.[ATTRIBUTE15] AS NVARCHAR(255))\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tAS [Additional Charges 2 Currency]\r\n\t,\t\t\tCAST(pla.[PO_LINE_ID] AS NVARCHAR(255))\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tAS [PO Line ID]\r\n\t,\t\t\tCAST(pla.[FROM_HEADER_ID] AS NVARCHAR(255))\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tAS [From Header ID]\r\n\t,\t\t\tCAST(pla.[PRC_BU_ID] AS NVARCHAR(255))\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tAS [Procurement BU ID]\r\n\t,\t\t\tCAST(pla.[LINE_STATUS] AS NVARCHAR(255))\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tAS [Line Status]\r\n\t,\t\t\tCAST(pla.[LINE_NUM] AS NVARCHAR(255))\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tAS [Line Number]\r\n\t,\t\t\tCAST(pla.[ITEM_ID] AS NVARCHAR(255))\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tAS [Item ID]\r\n\t,\t\t\tCAST(pla.[CATEGORY_ID] AS NVARCHAR(255))\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tAS [Category ID]\r\n\t,\t\t\tCAST(pla.[ITEM_DESCRIPTION]\t AS NVARCHAR(255))\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tAS [Item Description]\r\n\t,\t\t\tCAST(pla.[UOM_CODE] AS NVARCHAR(255))\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tAS [UOM Code]\r\n\t,\t\t\tCAST(CASE WHEN pla.[UNIT_PRICE] IS NULL THEN '0' ELSE pla.[UNIT_PRICE] END AS NUMERIC(28,2))AS [Unit Price]\r\n\t,\t\t\tCAST(pla.[QUANTITY]\t AS NVARCHAR(255))\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tAS [Ordered Quantity]\r\n\t,\t\t\tCAST(pla.[FROM_LINE_ID]\t AS NVARCHAR(255))\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tAS [From Line ID]\r\n\t,\t\t\tCAST(pla.[VENDOR_PRODUCT_NUM] AS NVARCHAR(255))\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tAS [Supplier Item]\r\n\t,\t\t\tCAST(pla.[QUANTITY_COMMITTED] AS NVARCHAR(255))\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tAS [Blanket Agreement Quantity]\t\r\n\t,\t\t\tCAST(pla.[CLOSED_DATE] AS NVARCHAR(255))\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tAS [Closed Date]\r\n\t,\t\t\tCAST(pla.[CANCEL_REASON] AS NVARCHAR(255))\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tAS [Cancel Reason]\r\n\tINTO\t\t[Core].[PurchaseOrders]\r\n\tFROM\t\t[RAW].[O.PO_HEADERS_ALL] pha\t\t\t\t\t\r\n\tLEFT JOIN\t[RAW].[O.PO_LINES_ALL] pla\t\t\t\t\r\n\tON\t\t\tpla.[PO_HEADER_ID] = pha.[PO_HEADER_ID]\r\n\tWHERE\t\tpha.[TYPE_LOOKUP_CODE] = 'STANDARD'\r\n\r\n\r\n/********************************************************************************************************\r\n\tStep 1.10:\tCreate core sales contracts table.\r\n\r\n\t\t\t\tCore.SalesContracts is built by joining the tables [RAW].[O.OKC_K_HEADERS_ALL_B],\r\n\t\t\t\t[RAW].[O.OKC_K_HEADERS_TL], [RAW].[O.OKC_K_LINES_B], [RAW].[O.OKC_K_LINES_TL], \r\n\t\t\t\t[RAW].[O.OKC_K_PARTY_ROLES_B] and [RAW].[O.QP_PRICING_TERMS_B] \r\n\r\n\r\n\t\t\t\t[RAW].[O.OKC_K_PARTY_ROLES_B] is joined twice. In the first join it is filtered for\r\n\t\t\t\t[RLE_CODE] = 'SUPPLIER' to bring through the supplier details. In the second join it\r\n\t\t\t\tis filtered for [RLE_CODE] = 'CUSTOMER' to bring through the customer details.\r\n\r\n********************************************************************************************************/\r\n\r\n\tIF OBJECT_ID('[Core].[SalesContracts]','U') IS NOT NULL\r\n\t\tDROP TABLE [Core].[SalesContracts]\r\n\t\t\r\n\tSELECT\t\tCAST(sch.[ID] AS NVARCHAR(255))\t\t\t\t\t\t\t\tAS [Contract Header ID]\r\n\t,\t\t\tCAST(sch.[MAJOR_VERSION] AS NVARCHAR(255))\t\t\t\t\t\tAS [Sales Contract Version]\r\n\t,\t\t\tCAST(sch.[CONTRACT_ID] AS NVARCHAR(255))\t\t\t\t\t\tAS [Contract ID]\r\n\t,\t\t\tCAST(sch.[ATTRIBUTE10] AS NVARCHAR(255))\t\t\t\t\t\tAS [Customer Bill To]\r\n\t,\t\t\tCAST(sch.[ATTRIBUTE11] AS NVARCHAR(255))\t\t\t\t\t\tAS [Customer Ship To]\r\n\t,\t\t\tCAST(sch.[ATTRIBUTE16] AS NVARCHAR(255))\t\t\t\t\t\tAS [Shipping Method]\r\n\t,\t\t\tCAST(sch.[VERSION_TYPE]\t AS NVARCHAR(255))\t\t\t\t\tAS [Version Type]\r\n\t,\t\t\tCAST(sch.[CONTRACT_NUMBER] AS NVARCHAR(255))\t\t\t\t\tAS [Sales Contract Number]\r\n\t,\t\t\tCAST(sch.[CONTRACT_TYPE_ID]\t AS NVARCHAR(255))\t\t\t\tAS [Contract Type ID]\r\n\t,\t\t\tCAST(sch.[ORG_ID] AS NVARCHAR(255))\t\t\t\t\t\t\tAS [Business Unit]\r\n\t,\t\t\tCAST(sch.[STS_CODE] AS NVARCHAR(255))\t\t\t\t\t\t\tAS [Sales Contract Status]\r\n\t,\t\t\tCAST(sch.[CURRENCY_CODE] AS NVARCHAR(255))\t\t\t\t\t\tAS [Currency Code]\r\n\t,\t\t\tCAST(sch.[START_DATE] AS NVARCHAR(255))\t\t\t\t\t\tAS [Sales Contract Start Date]\r\n\t,\t\t\tCAST(sch.[END_DATE]\t AS NVARCHAR(255))\t\t\t\t\t\tAS [Sales Contract End Date]\r\n\t,\t\t\tCAST(sch.[LEGAL_ENTITY_ID] AS NVARCHAR(255))\t\t\t\t\tAS [Legal Entity ID]\r\n\t,\t\t\tCAST(sch.[PRICING_STRATEGY_ID] AS NVARCHAR(255))\t\t\t\tAS [Pricing Strategy ID]\r\n\t,\t\t\tCAST(sch.[ATTRIBUTE14] AS NVARCHAR(255))\t\t\t\t\t\tAS [Payment Term]\r\n\t,\t\t\tCAST(sch.[AMENDMENT_EFFECTIVE_DATE] AS NVARCHAR(255))\t\t\tAS [Ammendment Effective Date]\r\n\t,\t\t\tCAST(sch.[APPROVAL_NOTE] AS NVARCHAR(255))\t\t\t\t\t\tAS [Approval Note]\r\n\t,\t\t\tCAST(sch.[ATTRIBUTE7] AS NVARCHAR(255))\t\t\t\t\t\tAS [VET ID]\r\n\t,\t\t\tCAST(sch.[DATE_APPROVED] AS NVARCHAR(255))\t\t\t\t\t\tAS [Date Approved]\r\n\t,\t\t\tCAST(sch.[ATTRIBUTE1] AS NVARCHAR(255))\t\t\t\t\t\tAS [Transporter]\r\n\t,\t\t\tCAST(sch.[ATTRIBUTE_NUMBER1] AS NVARCHAR(255))\t\t\t\t\tAS [Transporter Unit Price]\r\n\t,\t\t\tCAST(sch.[ATTRIBUTE2] AS NVARCHAR(255))\t\t\t\t\t\tAS [Additional Charges 1 Supplier]\r\n\t,\t\t\tCAST(sch.[ATTRIBUTE_NUMBER2] AS NVARCHAR(255))\t\t\t\t\tAS [Additional Charges 1 Unit Price]\r\n\t,\t\t\tCAST(sch.[TRN_CODE]\t AS NVARCHAR(255))\t\t\t\t\t\tAS [Termination reason]\r\n\t,\t\t\tCAST(sch.[DATE_TERMINATED] AS NVARCHAR(255))\t\t\t\t\tAS [Terminated Date]\r\n\t,\t\t\tCAST(sch.[ATTRIBUTE3] AS NVARCHAR(255))\t\t\t\t\t\tAS [Disposal Method]\r\n\t,\t\t\tCAST(sch.[ATTRIBUTE4] AS NVARCHAR(255))\t\t\t\t\t\tAS [Waste Stream Number]\r\n\t,\t\t\tCAST(sch.[ATTRIBUTE5] AS NVARCHAR(255))\t\t\t\t\t\tAS [Waste Description]\r\n\t,\t\t\tCAST(sch.[ATTRIBUTE_NUMBER3] AS NVARCHAR(255))\t\t\t\t\tAS [Transporter Amount]\r\n\t,\t\t\tCAST(sch.[ATTRIBUTE12] AS NVARCHAR(255))\t\t\t\t\t\tAS [Transporter Currency]\r\n\t,\t\t\tCAST(LEFT(sch.[ATTRIBUTE_DATE1],10) AS NVARCHAR(255))\t\t\tAS [Deal Date]\r\n\t,\t\t\tCAST(sch.[ATTRIBUTE6] AS NVARCHAR(255))\t\t\t\t\t\tAS [Sustainability Position]\r\n\t,\t\t\tCAST(sch.[ATTRIBUTE15] AS NVARCHAR(255))\t\t\t\t\t\tAS [Sustainability Position Details]\r\n\t,\t\t\tCAST(sch.[COMMITMENT_AMOUNT] AS NVARCHAR(255))\t\t\t\t\tAS [Commitment Amount]\r\n\t,\t\t\tCAST(sch.[DATETIME_CANCELLED] AS NVARCHAR(255))\t\t\t\tAS [Cancelled Date]\r\n\t,\t\t\tCAST(sch.[ATTRIBUTE19] AS NVARCHAR(255))\t\t\t\t\t\tAS [Additional Charges 1 Description]\r\n\t,\t\t\tCAST(sch.[ATTRIBUTE13] AS NVARCHAR(255))\t\t\t\t\t\tAS [Additional Charges 1 Currency]\r\n\t,\t\t\tCAST(sch.[ATTRIBUTE21] AS NVARCHAR(255))\t\t\t\t\t\tAS [Allow Multiple Shipping Addresses]\r\n\t,\t\t\tCAST(sch.[ATTRIBUTE17] AS NVARCHAR(255))\t\t\t\t\t\tAS [Additional Charges 2 Supplier]\r\n\t,\t\t\tCAST(sch.[ATTRIBUTE20] AS NVARCHAR(255))\t\t\t\t\t\tAS [Additional Charges 2 Description]\r\n\t,\t\t\tCAST(sch.[ATTRIBUTE_NUMBER5] AS NVARCHAR(255))\t\t\t\t\tAS [Additional Charges 2 Unit Price]\r\n\t,\t\t\tCAST(sch.[ATTRIBUTE_NUMBER6] AS NVARCHAR(255))\t\t\t\t\tAS [Additional Charges 2 Amount]\r\n\t,\t\t\tCAST(sch.[ATTRIBUTE_NUMBER4] AS NVARCHAR(255))\t\t\t\t\tAS [Additional Charges 1 Amount]\r\n\t,\t\t\tCAST(sch.[ATTRIBUTE18] AS NVARCHAR(255))\t\t\t\t\t\tAS [Additional Charges 2 Currency]\r\n\t,\t\t\tCAST(sct.[LANGUAGE]\t AS NVARCHAR(255))\t\t\t\t\t\tAS [Language]\r\n\t,\t\t\tCAST(sct.[DESCRIPTION] AS NVARCHAR(255))\t\t\t\t\t\tAS [Description]\r\n\t,\t\t\tCAST(sct.[COGNOMEN] AS NVARCHAR(255))\t\t\t\t\t\t\tAS [Trader]\r\n\t,\t\t\tCAST(sct.[VERSION_DESCRIPTION]\t AS NVARCHAR(255))\t\t\tAS [Additional Description]\r\n\t,\t\t\tCAST(scl.[ID] AS NVARCHAR(255))\t\t\t\t\t\t\t\tAS [Line ID]\r\n\t--,\t\t\tCAST(scl.[LINE_ID]\t\t\t\t\t\tAS [Line ID 2]\r\n\t,\t\t\tCAST(scl.[LINE_NUMBER] AS NVARCHAR(255))\t\t\t\t\t\tAS [Line Number]\r\n\t,\t\t\tCAST(scl.[LINE_TYPE_ID] AS NVARCHAR(255))\t\t\t\t\t\tAS [Line Type ID]\r\n\t,\t\t\tCAST(LEFT(scl.[START_DATE],10) AS NVARCHAR(255))\t\t\t\tAS [Line Start Date]\r\n\t,\t\t\tCAST(LEFT(scl.[END_DATE],10) AS NVARCHAR(255))\t\t\t\t\tAS [Line End Date]\r\n\t,\t\t\tCAST(scl.[STS_CODE]\t AS NVARCHAR(255))\t\t\t\t\t\tAS [Sts Code]\r\n\t,\t\t\tCAST(scl.[UOM_CODE]\t AS NVARCHAR(255))\t\t\t\t\t\tAS [UOM Code]\r\n\t,\t\t\tCAST(scl.[PRICE_LIST_ID] AS NVARCHAR(255))\t\t\t\t\t\tAS [Price List ID]\r\n\t,\t\t\tCAST(scl.[AGREED_QTY] AS NVARCHAR(255))\t\t\t\t\t\tAS [Line Quantity]\r\n\t,\t\t\tCAST(scl.[ATTRIBUTE3] AS NVARCHAR(255))\t\t\t\t\t\tAS [Incoterm]\r\n\t,\t\t\tCAST(scl.[AGREED_AMT] AS NVARCHAR(255))\t\t\t\t\t\tAS [Line Amount]\r\n\t,\t\t\tCAST(scl.[ATTRIBUTE7] AS NVARCHAR(255))\t\t\t\t\t\tAS [Quality]\r\n\t,\t\t\tCAST(scl.[ATTRIBUTE2] AS NVARCHAR(255))\t\t\t\t\t\tAS [Tolerance]\r\n\t,\t\t\tCAST(scl.[ATTRIBUTE6] AS NVARCHAR(255))\t\t\t\t\t\tAS [Sustainability Contact]\r\n\t,\t\t\tCAST(scl.[ATTRIBUTE9] AS NVARCHAR(255))\t\t\t\t\t\tAS [Nomination]\r\n\t,\t\t\tCAST(scl.[ATTRIBUTE10] AS NVARCHAR(255))\t\t\t\t\t\tAS [Nomination Requirement]\r\n\t,\t\t\tCAST(scl.[ATTRIBUTE11] AS NVARCHAR(255))\t\t\t\t\t\tAS [Lay Time]\r\n\t,\t\t\tCAST(scl.[ATTRIBUTE12] AS NVARCHAR(255))\t\t\t\t\t\tAS [Inspection]\r\n\t,\t\t\tCAST(scl.[ATTRIBUTE14] AS NVARCHAR(255))\t\t\t\t\t\tAS [Demurrage Vessel]\r\n\t,\t\t\tCAST(scl.[ATTRIBUTE15] AS NVARCHAR(255))\t\t\t\t\t\tAS [Legislation]\r\n\t,\t\t\tCAST(scl.[ATTRIBUTE4] AS NVARCHAR(255))\t\t\t\t\t\tAS [Laycan]\r\n\t,\t\t\tCAST(scl.[ATTRIBUTE8] AS NVARCHAR(255))\t\t\t\t\t\tAS [Temperature]\r\n\t,\t\t\tCAST(scl.[ATTRIBUTE13] AS NVARCHAR(255))\t\t\t\t\t\tAS [Detenation Demurrage]\r\n\t,\t\t\tCAST(sclt.[ITEM_NAME] AS NVARCHAR(255))\t\t\t\t\t\tAS [Item Name]\r\n\t,\t\t\tCAST(sup.[ID] AS NVARCHAR(255))\t\t\t\t\t\t\t\tAS [Supplier Party Role ID]\r\n\t,\t\t\tCAST(sup.[OBJECT1_ID1] AS NVARCHAR(255))\t\t\t\t\t\tAS [Sales Contract Supplier]\r\n\t,\t\t\tCAST(cus.[ID] AS NVARCHAR(255))\t\t\t\t\t\t\t\tAS [Customer Party Role ID]\r\n\t,\t\t\tCAST(cus.[OBJECT1_ID1] AS NVARCHAR(255))\t\t\t\t\t\tAS [Sales Contract Customer]\r\n\t,\t\t\tCAST(scpt.[PRICING_TERM_ID]\t AS NVARCHAR(255))\t\t\t\tAS [Pricing Term ID]\r\n\t,\t\t\tCAST(scpt.[PARENT_ENTITY_TYPE_CODE] AS NVARCHAR(255))\t\t\tAS [Parent Entity Type Code]\r\n\t,\t\t\tCAST(scpt.[PARENT_ENTITY_KEY_COLUMN1] AS NVARCHAR(255))\t\tAS [Parent Entity Key Column 1]\r\n\t,\t\t\tCAST(scpt.[PARENT_ENTITY_KEY_COLUMN2] AS NVARCHAR(255))\t\tAS [Parent Entity Key Column 2]\r\n\t,\t\t\tCAST(scpt.[PARENT_ENTITY_KEY_COLUMN3] AS NVARCHAR(255))\t\tAS [Parent Entity Key Column 3]\r\n\t,\t\t\tCAST(scpt.[PARENT_ENTITY_KEY_COLUMN4] AS NVARCHAR(255))\t\tAS [Parent Entity Key Column 4]\r\n\t,\t\t\tCAST(scpt.[PARENT_ENTITY_KEY_COLUMN5] AS NVARCHAR(255))\t\tAS [List Price]\r\n\t,\t\t\tCAST(scpt.[ITEM_ID]\t AS NVARCHAR(255))\t\t\t\t\t\tAS [Item ID]\r\n\t,\t\t\tCAST(scpt.[PRICING_CURRENCY_CODE] AS NVARCHAR(255))\t\t\tAS [Pricing Currency Code]\r\n\t,\t\t\tCAST(scpt.[PRICING_UOM_CODE] AS NVARCHAR(255))\t\t\t\t\tAS [Pricing UOM Code]\r\n\t,\t\t\tCAST(scpt.[ADJUSTMENT_AMOUNT] AS NVARCHAR(255))\t\t\t\tAS [Agreement Price]\r\n\tINTO\t\t[Core].[SalesContracts]\r\n\tFROM\t\t[RAW].[O.OKC_K_HEADERS_ALL_B] sch\t\t\t\t\r\n\tLEFT JOIN\t[RAW].[O.OKC_K_HEADERS_TL] sct\t\t\t\t\r\n\tON\t\t\tsch.[ID] = sct.[ID]\r\n\tAND\t\t\tsch.[MAJOR_VERSION] = sct.[MAJOR_VERSION]\r\n\tLEFT JOIN\t[RAW].[O.OKC_K_LINES_B] scl\r\n\tON\t\t\tsch.[ID] = scl.[CHR_ID]\r\n\tAND\t\t\tsch.[MAJOR_VERSION] = scl.[MAJOR_VERSION]\r\n\tLEFT JOIN\t[RAW].[O.OKC_K_LINES_TL] sclt\r\n\tON\t\t\tscl.[ID] = sclt.[ID]\r\n\tAND\t\t\tscl.[MAJOR_VERSION] = sclt.[MAJOR_VERSION]\r\n\tLEFT JOIN\t(\r\n\t\t\t\t\tSELECT\t\t*\r\n\t\t\t\t\tFROM\t\t[RAW].[O.OKC_K_PARTY_ROLES_B]\r\n\t\t\t\t\tWHERE\t\t[RLE_CODE] = 'SUPPLIER'\r\n\t\t\t\t) sup\t\r\n\tON\t\t\tsch.[ID] = sup.[CHR_ID]\r\n\tAND\t\t\tsch.[MAJOR_VERSION] = sup.[MAJOR_VERSION]\r\n\tLEFT JOIN\t(\r\n\t\t\t\t\tSELECT\t\t*\r\n\t\t\t\t\tFROM\t\t[RAW].[O.OKC_K_PARTY_ROLES_B]\r\n\t\t\t\t\tWHERE\t\t[RLE_CODE] = 'CUSTOMER'\r\n\t\t\t\t) cus\t\r\n\tON\t\t\tsch.[ID] = cus.[CHR_ID]\r\n\tAND\t\t\tsch.[MAJOR_VERSION] = cus.[MAJOR_VERSION]\r\n\tLEFT JOIN\t[RAW].[O.QP_PRICING_TERMS_B] scpt\r\n\tON\t\t\tscpt.[PARENT_ENTITY_KEY_COLUMN1] = sch.[ID]\r\n\tAND\t\t\tscpt.[PARENT_ENTITY_KEY_COLUMN2] = scl.[ID]\r\n\tAND\t\t\tscpt.[PARENT_ENTITY_KEY_COLUMN3] = sch.[MAJOR_VERSION]\r\n\r\n\r\n/********************************************************************************************************\r\n\tStep 1.11:\tCreate core sales orders fulfilled table.\r\n\r\n\t\t\t\tCore.SalesOrders_Fulfilled is built using the table [RAW].[O.DOO_FULFILL_LINES_ALL]\r\n\r\n********************************************************************************************************/\r\n\r\n\tIF OBJECT_ID('[Core].[SalesOrders_Fulfilled]','U') IS NOT NULL\r\n\t\tDROP TABLE [Core].[SalesOrders_Fulfilled]\r\n\r\n\tSELECT\t\tCAST([CANCELED_FLAG] AS NVARCHAR(255))\t\t\t\t\tAS [CANCELED_FLAG]\r\n\t,\t\t\tCAST([CARRIER_ID] AS NVARCHAR(255))\t\t\t\t\tAS [CARRIER_ID]\r\n\t,\t\t\tCAST([FULFILL_ORG_ID] AS NVARCHAR(255))\t\t\t\tAS [FULFILL_ORG_ID]\r\n\t,\t\t\tCAST([HEADER_ID] AS NVARCHAR(255))\t\t\t\t\t\tAS [HEADER_ID]\r\n\t,\t\t\tCAST([OPEN_FLAG] AS NVARCHAR(255))\t\t\t\t\t\tAS [OPEN_FLAG]\r\n\t,\t\t\tCAST([ORG_ID] AS NVARCHAR(255))\t\t\t\t\t\tAS [ORG_ID]\r\n\t,\t\t\tCAST([PAYMENT_TERM_ID] AS NVARCHAR(255))\t\t\t\tAS [PAYMENT_TERM_ID]\r\n\t,\t\t\tCAST([REQUEST_SHIP_DATE] AS NVARCHAR(255))\t\t\t\tAS [REQUEST_SHIP_DATE]\r\n\t,\t\t\tCAST([SOURCE_ORDER_ID] AS NVARCHAR(255))\t\t\t\tAS [SOURCE_ORDER_ID]\r\n\t,\t\t\tCAST([SOURCE_ORDER_NUMBER] AS NVARCHAR(255))\t\t\tAS [SOURCE_ORDER_NUMBER]\r\n\t,\t\t\tCAST([SOURCE_ORG_ID] AS NVARCHAR(255))\t\t\t\t\tAS [SOURCE_ORG_ID]\r\n\t,\t\t\tCAST([STATUS_CODE] AS NVARCHAR(255))\t\t\t\t\tAS [STATUS_CODE]\r\n\t,\t\t\tCAST([FULFILL_LINE_ID] AS NVARCHAR(255))\t\t\t\tAS [FULFILL_LINE_ID]\r\n\t,\t\t\tCAST([LINE_ID] AS NVARCHAR(255))\t\t\t\t\t\tAS [LINE_ID]\r\n\t,\t\t\tCAST([FULFILL_LINE_NUMBER] AS NVARCHAR(255))\t\t\tAS [FULFILL_LINE_NUMBER]\r\n\t,\t\t\tCAST([INVENTORY_ITEM_ID] AS NVARCHAR(255))\t\t\t\tAS [INVENTORY_ITEM_ID]\r\n\t,\t\t\tCAST([ITEM_TYPE_CODE] AS NVARCHAR(255))\t\t\t\tAS [ITEM_TYPE_CODE]\r\n\t,\t\t\tCAST(ISNULL([ORDERED_QTY],'0') AS NVARCHAR(255))\tAS [ORDERED_QTY]\r\n\t,\t\t\tCAST([SOURCE_LINE_ID] AS NVARCHAR(255))\t\t\t\t\t\t\tAS [SOURCE_LINE_ID]\r\n\t,\t\t\tCAST([SOURCE_LINE_NUMBER] AS NVARCHAR(255))\t\t\t\t\t\tAS [SOURCE_LINE_NUMBER]\r\n\t,\t\t\tCAST([SOURCE_SCHEDULE_ID] AS NVARCHAR(255))\t\t\t\t\t\tAS [SOURCE_SCHEDULE_ID]\r\n\t,\t\t\tCAST([SOURCE_SCHEDULE_NUMBER] AS NVARCHAR(255))\t\t\t\t\tAS [SOURCE_SCHEDULE_NUMBER]\r\n\t,\t\t\tCAST([ORDERED_UOM] AS NVARCHAR(255))\t\t\t\t\t\t\t\tAS [ORDERED_UOM]\r\n\t,\t\t\tCAST([INVOICE_INTERFACED_FLAG] AS NVARCHAR(255))\t\t\t\t\tAS [INVOICE_INTERFACED_FLAG]\r\n\t,\t\t\tCAST([BILL_TO_CUSTOMER_ID] AS NVARCHAR(255))\t\t\t\t\t\tAS [BILL_TO_CUSTOMER_ID]\r\n\t,\t\t\tCAST([BILL_TO_SITE_USE_ID] AS NVARCHAR(255))\t\t\t\t\t\tAS [BILL_TO_SITE_USE_ID]\r\n\t,\t\t\tCAST([UNIT_SELLING_PRICE] AS NVARCHAR(255))\t\t\t\t\t\tAS [UNIT_SELLING_PRICE]\r\n\t,\t\t\tCAST([INVENTORY_ORGANIZATION_ID] AS NVARCHAR(255))\t\t\t\t\tAS [INVENTORY_ORGANIZATION_ID]\r\n\t,\t\t\tCAST([SHIP_TO_PARTY_ID]\t AS NVARCHAR(255))\t\t\t\t\t\tAS [SHIP_TO_PARTY_ID]\r\n\t,\t\t\tCAST([SHIP_TO_PARTY_SITE_ID] AS NVARCHAR(255))\t\t\t\t\t\tAS [SHIP_TO_PARTY_SITE_ID]\r\n\t,\t\t\tCAST([ITEM_SUB_TYPE_CODE] AS NVARCHAR(255))\t\t\t\t\t\tAS [ITEM_SUB_TYPE_CODE]\r\n\t,\t\t\tCAST([DEFAULT_TAXATION_COUNTRY]\t AS NVARCHAR(255))\t\t\t\tAS [DEFAULT_TAXATION_COUNTRY]\r\n\t,\t\t\tCAST([PRODUCT_TYPE]\t AS NVARCHAR(255))\t\t\t\t\t\tAS [PRODUCT_TYPE]\r\n\t,\t\t\tCAST([TRX_BUSINESS_CATEGORY] AS NVARCHAR(255))\t\t\t\t\t\tAS [TRX_BUSINESS_CATEGORY]\r\n\t,\t\t\tCAST([ASSESSABLE_VALUE] AS NVARCHAR(255))\t\t\t\t\t\t\tAS [ASSESSABLE_VALUE]\r\n\t,\t\t\tCAST([PURCHASING_ENABLED_FLAG] AS NVARCHAR(255))\t\t\t\t\tAS [PURCHASING_ENABLED_FLAG]\r\n\t,\t\t\tCAST([APPLIED_PRICE_LIST_ID] AS NVARCHAR(255))\t\t\t\t\t\tAS [APPLIED_PRICE_LIST_ID]\r\n\t,\t\t\tCAST([CHANGE_ELIGIBLE_FLAG]\t AS NVARCHAR(255))\t\t\t\t\tAS [CHANGE_ELIGIBLE_FLAG]\r\n\t,\t\t\tCAST([MODIFIED_FLAG] AS NVARCHAR(255))\t\t\t\t\t\t\t\tAS [MODIFIED_FLAG]\r\n\t,\t\t\tCAST([UNREFERENCED_RETURN_FLAG]\t AS NVARCHAR(255))\t\t\t\tAS [UNREFERENCED_RETURN_FLAG]\r\n\t,\t\t\tCAST([UNIT_QUANTITY] AS NVARCHAR(255))\t\t\t\t\t\t\t\tAS [UNIT_QUANTITY]\r\n\t,\t\t\tCAST([PROCESS_INSTANCE_ID] AS NVARCHAR(255))\t\t\t\t\t\tAS [PROCESS_INSTANCE_ID]\r\n\t,\t\t\tCAST([PROCESS_NUMBER] AS NVARCHAR(255))\t\t\t\t\t\t\tAS [PROCESS_NUMBER]\r\n\t,\t\t\tCAST([TRANSPORTATION_PLANNED_FLAG] AS NVARCHAR(255))\t\t\t\tAS [TRANSPORTATION_PLANNED_FLAG]\r\n\t,\t\t\tCAST([ASSET_TRACKED_FLAG] AS NVARCHAR(255))\t\t\t\t\t\tAS [ASSET_TRACKED_FLAG]\r\n\t,\t\t\tCAST([PRJ_REC_INDICATOR] AS NVARCHAR(255))\t\t\t\t\t\t\tAS [PRJ_REC_INDICATOR]\r\n\t,\t\t\tCAST([MDO_FLAG]\t AS NVARCHAR(255))\t\t\t\t\t\t\t\tAS [MDO_FLAG]\r\n\t,\t\t\tCAST([FULFILL_INSTANCE_ID] AS NVARCHAR(255))\t\t\t\t\t\tAS [FULFILL_INSTANCE_ID]\r\n\t,\t\t\tCAST(ISNULL([FULFILLED_QTY],'0') AS NVARCHAR(255))\t\tAS [FULFILLED_QTY]\r\n\t,\t\t\tCAST([CANCELED_QTY] AS NVARCHAR(255))\t\t\t\tAS [CANCELED_QTY]\r\n\t,\t\t\tCAST([SHIPPING_INSTRUCTIONS] AS NVARCHAR(255))\t\tAS [SHIPPING_INSTRUCTIONS]\r\n\t,\t\t\tCAST([REFERENCE_FLINE_ID] AS NVARCHAR(255))\t\t\tAS [REFERENCE_FLINE_ID]\r\n\t,\t\t\tCAST([PACKING_INSTRUCTIONS] AS NVARCHAR(255))\t\tAS [PACKING_INSTRUCTIONS]\r\n\t,\t\t\tCAST([CUSTOMER_PO_NUMBER] AS NVARCHAR(255))\t\t\tAS [CUSTOMER_PO_NUMBER]\r\n\t,\t\t\tCAST(ISNULL([RMA_DELIVERED_QTY],'0') AS NVARCHAR(255))\tAS [RMA_DELIVERED_QTY]\r\n\t,\t\t\tCAST([AGREEMENT_HEADER_ID] AS NVARCHAR(255))\t\t\tAS [AGREEMENT_HEADER_ID]\r\n\t,\t\t\tCAST([AGREEMENT_LINE_ID] AS NVARCHAR(255))\t\t\t\tAS [AGREEMENT_LINE_ID]\r\n\t,\t\t\tCAST([AGREEMENT_VERSION_NUMBER] AS NVARCHAR(255))\t\tAS [AGREEMENT_VERSION_NUMBER]\r\n\tINTO\t\t[Core].[SalesOrders_Fulfilled]\r\n\tFROM\t\t[RAW].[O.DOO_FULFILL_LINES_ALL]\r\n\r\n\r\n/********************************************************************************************************\r\n\tStep 1.12:\tCreate core on hand balance table.\r\n\r\n\t\t\t\tCore.OnHandBalance is built by joining the tables [RAW].[O.INV_ONHAND_QUANTITIES_DETAIL],\r\n\t\t\t\t[Core].[Items] and [Core].[Organizations]\r\n********************************************************************************************************/\r\n\r\n\tIF OBJECT_ID('[Core].[OnHandBalance]','U') IS NOT NULL\r\n\t\tDROP TABLE [Core].[OnHandBalance]\r\n\r\n\tSELECT\t\to.[Business Unit Name] \r\n\t,\t\t\to.[Inventory Organization Name] \r\n\t,\t\t\tCAST(oq.[INVENTORY_ITEM_ID]\t AS NVARCHAR(255))\t\t\t\t\t\t\t\t\t\tAS [Item ID]\r\n\t,\t\t\tCAST(oq.[ORGANIZATION_ID] AS NVARCHAR(255))\t\t\t\t\t\t\t\t\t\t\tAS [Inventory Organization ID]\r\n\t,\t\t\tCAST(oq.[PRIMARY_TRANSACTION_QUANTITY] AS NUMERIC(28,4))\t\tAS [Primary Transaction Quantity]\r\n\t,\t\t\tCAST(oq.[SUBINVENTORY_CODE] AS NVARCHAR(255))\t\t\t\t\t\t\t\t\t\t\tAS [Subinventory]\r\n\t,\t\t\tCAST(oq.[ONHAND_QUANTITIES_ID] AS NVARCHAR(255))\t\t\t\t\t\t\t\t\t\tAS [Onhand Quantities ID]\r\n\t,\t\t\tCAST(oq.[TRANSACTION_UOM_CODE]\t AS NVARCHAR(255))\t\t\t\t\t\t\t\t\tAS [Transaction UOM Code]\r\n\t,\t\t\tCAST(oq.[LOT_NUMBER] AS NVARCHAR(255))\t\t\t\t\t\t\t\t\t\t\t\t\tAS [Lot Number]\r\n\t,\t\t\ti.[Item Code]\r\n\t,\t\t\ti.[Item Name]\r\n\t,\t\t\ti.[Category Set Name]\r\n\t,\t\t\ti.[Category Code]\r\n\t,\t\t\ti.[Category Set Description]\r\n\tINTO\t\t[Core].[OnHandBalance]\r\n\tFROM\t\t[RAW].[O.INV_ONHAND_QUANTITIES_DETAIL] oq\r\n\tLEFT JOIN\t[Core].[Items] i\r\n\tON\t\t\toq.[INVENTORY_ITEM_ID] = i.[Inventory Item ID]\r\n\tAND\t\t\toq.[ORGANIZATION_ID] = i.[Organization ID]\r\n\tLEFT JOIN\t[Core].[Organizations] o\r\n\tON\t\t\toq.[ORGANIZATION_ID] = o.[Organization ID]\r\n\r\n\r\n\r\n/********************************************************************************************************\r\n\tStep 1.13:\tCreate core receiving transactions table.\r\n\r\n\t\t\t\tCore.ReceivingTransactions is built using the table [RAW].[O.RCV_TRANSACTIONS]\r\n********************************************************************************************************/\r\n\r\n\tIF OBJECT_ID('[Core].[ReceivingTransactions]','U') IS NOT NULL\r\n\t\tDROP TABLE [Core].[ReceivingTransactions]\r\n\r\n\tSELECT\t\tCAST([TRANSACTION_ID] AS NVARCHAR(255))\t\t\t\tAS [Transaction ID]\r\n\t,\t\t\tCAST([SHIP_FROM_LOCATION_ID] AS NVARCHAR(255))\t\t\tAS [Ship From Location ID]\r\n\t,\t\t\tCAST([ORGANIZATION_ID] AS NVARCHAR(255))\t\t\t\tAS [Organization ID]\r\n\t,\t\t\tCAST([CREATED_BY] AS NVARCHAR(255))\t\t\t\t\tAS [Created By]\r\n\t,\t\t\tCAST([TRANSACTION_TYPE] AS NVARCHAR(255))\t\t\t\tAS [Transaction Type]\r\n\t,\t\t\tCAST([TRANSACTION_DATE] AS NVARCHAR(255))\t\t\t\tAS [Transaction Date]\r\n\t,\t\t\tCAST([SHIPMENT_HEADER_ID] AS NVARCHAR(255))\t\t\tAS [Shipment Header ID]\r\n\t,\t\t\tCAST([SHIPMENT_LINE_ID] AS NVARCHAR(255))\t\t\t\tAS [Shipment Line ID]\r\n\t,\t\t\tCAST([SOURCE_DOCUMENT_CODE] AS NVARCHAR(255))\t\t\tAS [Source Document Code]\r\n\t,\t\t\tCAST([DESTINATION_TYPE_CODE] AS NVARCHAR(255))\t\t\tAS [Destination Type Code]\r\n\t,\t\t\tCAST([PRIMARY_QUANTITY]\t AS NVARCHAR(255))\t\t\tAS [Primary Quantity]\r\n\t,\t\t\tCAST([PRIMARY_UOM_CODE]\t AS NVARCHAR(255))\t\t\tAS [Primary UOM Code]\r\n\t,\t\t\tCAST([EMPLOYEE_ID] AS NVARCHAR(255))\t\t\t\t\tAS [Employee ID]\r\n\t,\t\t\tCAST([PARENT_TRANSACTION_ID] AS NVARCHAR(255))\t\t\tAS [Parent Transaction ID]\r\n\t,\t\t\tCAST([PO_HEADER_ID] AS NVARCHAR(255))\t\t\t\t\tAS [PO Header ID]\r\n\t,\t\t\tCAST([PO_LINE_ID] AS NVARCHAR(255))\t\t\t\t\tAS [PO Line ID]\r\n\t,\t\t\tCAST([PO_LINE_LOCATION_ID] AS NVARCHAR(255))\t\t\tAS [PO Line Location ID]\r\n\t,\t\t\tCAST([PO_DISTRIBUTION_ID] AS NVARCHAR(255))\t\t\tAS [PO Distribution ID]\r\n\t,\t\t\tCAST([PO_REVISION_NUM] AS NVARCHAR(255))\t\t\t\tAS [PO Revision Num]\r\n\t,\t\t\tCAST([DELIVER_TO_PERSON_ID] AS NVARCHAR(255))\t\t\tAS [Deliver To Person ID]\r\n\t,\t\t\tCAST([DELIVER_TO_LOCATION_ID] AS NVARCHAR(255))\t\tAS [Deliver To Location ID]\r\n\t,\t\t\tCAST([VENDOR_ID] AS NVARCHAR(255))\t\t\t\t\t\tAS [Vendor ID]\r\n\t,\t\t\tCAST([VENDOR_SITE_ID] AS NVARCHAR(255))\t\t\t\tAS [Vendor Site ID]\r\n\t,\t\t\tCAST([LOCATION_ID] AS NVARCHAR(255))\t\t\t\t\tAS [Location ID]\r\n\t,\t\t\tCAST([DESTINATION_CONTEXT] AS NVARCHAR(255))\t\t\tAS [Destination Context]\r\n\t,\t\t\tCAST([INTERFACE_TRANSACTION_ID] AS NVARCHAR(255))\t\tAS [Interface Transaction ID]\r\n\t,\t\t\tCAST([GROUP_ID] AS NVARCHAR(255))\t\t\t\t\t\tAS [Group ID]\r\n\t,\t\t\tCAST([SUBINVENTORY]\t AS NVARCHAR(255))\t\t\t\tAS [Subinventory]\r\n\t,\t\t\tCAST([FROM_SUBINVENTORY] AS NVARCHAR(255))\t\t\t\tAS [From Subinventory]\r\n\t,\t\t\tCAST([ATTRIBUTE1] AS NVARCHAR(255))\t\t\t\t\t\tAS [ATTRIBUTE1]\r\n\t,\t\t\tCAST([ATTRIBUTE2] AS NVARCHAR(255))\t\t\t\t\t\tAS [ATTRIBUTE2]\r\n\t,\t\t\tCAST([ATTRIBUTE4] AS NVARCHAR(255))\t\t\t\t\t\tAS [ATTRIBUTE4]\r\n\t,\t\t\tCAST([ATTRIBUTE_NUMBER1] AS NVARCHAR(255))\t\t\t\tAS [ATTRIBUTE_NUMBER1]\r\n\t,\t\t\tCAST([ATTRIBUTE_NUMBER2] AS NVARCHAR(255))\t\t\t\tAS [ATTRIBUTE_NUMBER2]\r\n\t,\t\t\tCAST([ATTRIBUTE_NUMBER3] AS NVARCHAR(255))\t\t\t\tAS [ATTRIBUTE_NUMBER3]\r\n\t,\t\t\tCAST([ATTRIBUTE_NUMBER8] AS NVARCHAR(255))\t\t\t\tAS [ATTRIBUTE_NUMBER8]\r\n\t,\t\t\tCAST([ATTRIBUTE_TIMESTAMP1] AS NVARCHAR(255))\t\t\tAS [ATTRIBUTE_TIMESTAMP1]\r\n\t,\t\t\tCAST([ATTRIBUTE_TIMESTAMP2] AS NVARCHAR(255))\t\t\tAS [ATTRIBUTE_TIMESTAMP2]\r\n\t,\t\t\tCAST([PO_UNIT_PRICE] AS NVARCHAR(255))\t\t\t\t\tAS [PO Unit Price]\r\n\t,\t\t\tCAST([CURRENCY_CONVERSION_RATE] AS NVARCHAR(255))\t\tAS [Currency Conversion Rate]\r\n\t,\t\t\tCAST([QUANTITY_BILLED] AS NVARCHAR(255))\t\t\t\tAS [Quantity Billed]\r\n\t,\t\t\tCAST([AMOUNT_BILLED] AS NVARCHAR(255))\t\t\t\t\tAS [Amount Billed]\r\n\t,\t\t\tCAST([ATTRIBUTE_NUMBER7] AS NVARCHAR(255))\t\t\t\tAS [ATTRIBUTE_NUMBER7]\r\n\t,\t\t\tCAST([FINAL_DISCHARGE_LOCATION_ID] AS NVARCHAR(255))\tAS [Final Discharge Location ID]\r\n\t,\t\t\tCAST([TRANSFER_ORDER_HEADER_ID] AS NVARCHAR(255))\t\tAS [Transfer Order Header ID]\r\n\t,\t\t\tCAST([TRANSFER_ORDER_LINE_ID] AS NVARCHAR(255))\t\tAS [Transfer Order Line ID]\r\n\t,\t\t\tCAST([REASON_ID] AS NVARCHAR(255))\t\t\t\t\t\tAS [Reason ID]\r\n\t,\t\t\tCAST([RECEIPT_ADVICE_HEADER_ID] AS NVARCHAR(255))\t\tAS [Receipt Advice Header ID]\r\n\tINTO\t\t[Core].[ReceivingTransactions]\r\n\tFROM\t\t[RAW].[O.RCV_TRANSACTIONS]\r\n\r\n\r\n/********************************************************************************************************\r\n\tStep 1.14:\tCreate core FX rates table.\r\n\r\n\t\t\t\tCore.FXRates is built using the [RAW].[O.GL_DAILY_RATES] table. \r\n********************************************************************************************************/\r\n\r\n\r\n\tIF OBJECT_ID('tempdb..#tempfx') IS NOT NULL\r\n\t\tDROP TABLE #tempfx\r\n\r\n\tSELECT\t\t\r\n\t\t\t\tfx.[CONVERSION_DATE]\r\n\t,\t\t\tCAST(CASE WHEN [FROM_CURRENCY] = 'EUR' and [TO_CURRENCY] = 'GBP'\r\n\t\t\t\t\tTHEN LEFT([CONVERSION_RATE],7) END AS NUMERIC(28,4))\t\t\t\t\tAS [EUR GBP]\r\n\t,\t\t\tCAST(CASE WHEN [FROM_CURRENCY] = 'EUR' and [TO_CURRENCY] = 'USD'\r\n\t\t\t\t\tTHEN [CONVERSION_RATE] END AS NUMERIC(28,4))\t\t\t\t\t\t\tAS [EUR USD]\r\n\tINTO\t\t#tempfx\r\n\tFROM\t\t[RAW].[O.GL_DAILY_RATES] fx\r\n\tWHERE\t\t[FROM_CURRENCY] = 'EUR'\r\n\tand\t\t\t[TO_CURRENCY] IN ('GBP','USD')\r\n\tGROUP BY\t[CONVERSION_DATE], [FROM_CURRENCY], [TO_CURRENCY], [CONVERSION_RATE]\r\n\r\n\r\n\tIF OBJECT_ID('[Core].[FXRates]','U') IS NOT NULL\r\n\tDROP TABLE [Core].[FXRates]\r\n\r\n\tSELECT\r\n\t\t\t\t[CONVERSION_DATE]\r\n\t,\t\t\tCASE WHEN AVG([EUR GBP]) > 2 \r\n\t\t\t\t\tTHEN (AVG([EUR GBP]))/10 \r\n\t\t\t\t\tELSE AVG([EUR GBP])\t\t\t\t\t\t\t\t\t\t\t\t\tEND\tAS [EUR GBP]\r\n\t,\t\t\tAVG([EUR USD])\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tAS [EUR USD]\r\n\tINTO\t\t[Core].[FXRates]\r\n\tFROM\t\t#tempfx\r\n\tGROUP BY\t[CONVERSION_DATE]"
						}
					]
				}
			}
		],
		"folder": {
			"name": "Trade/Exp and Pos"
		},
		"annotations": [],
		"lastPublishTime": "2022-11-17T12:13:48Z"
	},
	"type": "Microsoft.DataFactory/factories/pipelines"
}