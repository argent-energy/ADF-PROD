{
	"name": "SQL_Margin_Core_Tables_Script",
	"properties": {
		"activities": [
			{
				"name": "Margin Core Tables Script",
				"type": "Script",
				"dependsOn": [],
				"policy": {
					"timeout": "7.00:00:00",
					"retry": 0,
					"retryIntervalInSeconds": 30,
					"secureOutput": false,
					"secureInput": false
				},
				"userProperties": [],
				"linkedServiceName": {
					"referenceName": "SqlServerArgent",
					"type": "LinkedServiceReference"
				},
				"typeProperties": {
					"scripts": [
						{
							"type": "NonQuery",
							"text": "/*==============================================================================================================================*\r\n * Project:\t\tArgent\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t*\r\n * Purpose:\t\tCreate core tables that feed in to Margin data marts.\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t*\r\n * Description:\t1) Creates sales orders, invoices and inventory tables \t\t\t\t\t\t\t\t\t\t\t\t\t\t\t*\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\r\n*\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t*\r\n * Prerequisites: Run pipelinie in Azure DWH.\t\t\t \t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t*\r\n *\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t*\r\n * Outputs: Tables \"Core.SalesOrders\", \"Core.APInvoices\", \"Core.ARInvoices\", \"Core.InventoryTransactions\"\t\t\t\t\t\t*\r\n *\t\t\t\"Core.ShippingDetails\", \"Core.InventoryLotNumbers\", \"Core.InventoryLotNumberTransactions\"\t\t\t\t\t\t\t*\r\n *\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t*\r\n *\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t*\r\n * Date:       29/07/2022\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t*\r\n * Version:     1.0\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t*\t\t\r\n *\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t*\r\n * SQL ATR - Basic joins\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t* \r\n *\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t*\r\n *==============================================================================================================================*\r\n * Updates:\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t*\r\n * Date\t\t| Version | Author\t\t| Change made\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t*\r\n * -----------------------------------------------------------------------------------------------------------------------------*\r\n * --/--/-- |  1.-\t  |\t\t\t\t|\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t*\r\n *\t\t\t|\t\t  |\t\t\t\t|\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t*\r\n *==============================================================================================================================*/\r\n\r\n/********************************************************************************************************\r\n\tStep 1.1\tCreate core Sales Orders table.\r\n********************************************************************************************************/\r\n\r\n\tIF OBJECT_ID('[Core].[SalesOrders]','U') IS NOT NULL\r\n\t\tDROP TABLE [Core].[SalesOrders]\r\n\r\n\tSELECT\t\tCAST(soh.[HEADER_ID] AS NVARCHAR(255))\t\t\t\t\t\t\t\tAS [Header ID]\r\n\t,\t\t\tCAST(soh.[ORDER_NUMBER] AS NVARCHAR(255))\t\t\t\t\t\t\tAS [Order Number]\r\n\t,\t\t\tCAST(soh.[ORG_ID] AS NVARCHAR(255))\t\t\t\t\t\t\t\tAS [Org ID]\r\n\t,\t\t\tCAST(soh.[LEGAL_ENTITY_ID] AS NVARCHAR(255))\t\t\t\t\t\tAS [Legal Entity ID]\r\n\t,\t\t\tCAST(LEFT(soh.[ORDERED_DATE],10) AS DATE)\tAS [Ordered Date]\r\n\t,\t\t\tCAST(soh.[ORDER_TYPE_CODE] AS NVARCHAR(255))\t\t\t\t\t\tAS [Order Type Code]\r\n\t,\t\t\tCAST(soh.[TRANSACTIONAL_CURRENCY_CODE] AS NVARCHAR(255))\t\t\tAS [Transactional Currency Code]\r\n\t,\t\t\tCAST(soh.[STATUS_CODE] AS NVARCHAR(255))\t\t\t\t\t\t\tAS [Status Code]\r\n\t,\t\t\tCAST(soh.[OPEN_FLAG] AS NVARCHAR(255))\t\t\t\t\t\t\t\tAS [Open Flag]\r\n\t,\t\t\tCAST(soh.[ON_HOLD] AS NVARCHAR(255))\t\t\t\t\t\t\t\tAS [On Hold]\r\n\t,\t\t\tCAST(soh.[CANCELED_FLAG] AS NVARCHAR(255))\t\t\t\t\t\t\tAS [Canceled Flag]\r\n\t,\t\t\tCAST(soh.[CHANGE_VERSION_NUMBER] AS NVARCHAR(255))\t\t\t\t\tAS [Change Version Number]\r\n\t,\t\t\tCAST(soh.[IS_EDITABLE] AS NVARCHAR(255))\t\t\t\t\t\t\tAS [Is Editable]\r\n\t,\t\t\tCAST(soh.[SOLD_TO_PARTY_ID]\t AS NVARCHAR(255))\t\t\t\t\tAS [Sold To Party ID]\r\n\t,\t\t\tCAST(soh.[PRICING_SEGMENT_CODE] AS NVARCHAR(255))\t\t\t\t\tAS [Pricing Segment Code]\r\n\t,\t\t\tCAST(soh.[PRICING_STRATEGY_ID] AS NVARCHAR(255))\t\t\t\t\tAS [Pricing Strategy ID]\r\n\t,\t\t\tCAST(soh.[FULFILL_ORG_ID] AS NVARCHAR(255))\t\t\t\t\t\tAS [Fulfill Org ID]\r\n\t,\t\t\tCAST(soh.[REQUEST_SHIP_DATE] AS NVARCHAR(255))\t\t\t\t\t\tAS [Request Ship Date]\r\n\t,\t\t\tCAST(soh.[CARRIER_ID] AS NVARCHAR(255))\t\t\t\t\t\t\tAS [Carrier ID]\r\n\t,\t\t\tCAST(soh.[SHIP_MODE_OF_TRANSPORT] AS NVARCHAR(255))\t\t\t\tAS [Ship Mode Of Transport]\r\n\t,\t\t\tCAST(soh.[SHIP_CLASS_OF_SERVICE] AS NVARCHAR(255))\t\t\t\t\tAS [Ship Class Of Service]\r\n\t,\t\t\tCAST(soh.[SUBMITTED_FLAG] AS NVARCHAR(255))\t\t\t\t\t\tAS [Submitted Flag]\r\n\t,\t\t\tCAST(soh.[REFERENCE_HEADER_ID] AS NVARCHAR(255))\t\t\t\t\tAS [Reference Header ID]\r\n\t,\t\t\tCAST(soh.[PAYMENT_TERM_ID] AS NVARCHAR(255))\t\t\t\t\t\tAS [Payment Term ID]\r\n\t,\t\t\tCAST(soh.[MODIFIED_FLAG] AS NVARCHAR(255))\t\t\t\t\t\t\tAS [Modified Flag]\r\n\t,\t\t\tCAST(soh.[SUBMITTED_DATE] AS NVARCHAR(255))\t\t\t\t\t\tAS [Submitted Date]\r\n\t,\t\t\tCAST(soh.[SUBMITTED_BY]\t AS NVARCHAR(255))\t\t\t\t\t\tAS [Submitted By]\r\n\t,\t\t\tCAST(soh.[MDO_FLAG]\t AS NVARCHAR(255))\t\t\t\t\t\t\tAS [MDO Flag]\r\n\t,\t\t\tCAST(soh.[SOLD_TO_PARTY_CONTACT_ID]\t AS NVARCHAR(255))\t\t\tAS [Sold To Party Contact ID]\r\n\t,\t\t\tCAST(soh.[SOLD_TO_PARTY_CONTACT_POINT_ID] AS NVARCHAR(255))\t\tAS [Sold To Party Contact Point ID]\r\n\t,\t\t\tCAST(soh.[REQUEST_CANCEL_DATE]\t AS NVARCHAR(255))\t\t\t\tAS [Request Cancel Date]\r\n\t,\t\t\tCAST(soh.[CANCEL_REASON_CODE] AS NVARCHAR(255))\t\t\t\t\tAS [Cancel Reason Code]\r\n\t,\t\t\tCAST(soh.[CUSTOMER_PO_NUMBER] AS NVARCHAR(255))\t\t\t\t\tAS [Customer PO Number]\r\n\t,\t\t\tCAST(soh.[COMMENTS]\t AS NVARCHAR(255))\t\t\t\t\t\t\tAS [Comments]\r\n\t,\t\t\tCAST(soh.[AGREEMENT_HEADER_ID] AS NVARCHAR(255))\t\t\t\t\tAS [Agreement Header ID]\r\n\t,\t\t\tCAST(soh.[AGREEMENT_VERSION_NUMBER]\t AS NVARCHAR(255))\t\t\tAS [Agreement Version Number]\r\n\t,\t\t\tCAST(sol.[LINE_ID] AS NVARCHAR(255))\t\t\t\t\t\t\t\tAS [Line ID]\r\n\t,\t\t\tCAST(sol.[LINE_NUMBER] AS NVARCHAR(255))\t\t\t\t\t\t\tAS [Line Number]\r\n\t,\t\t\tCAST(sol.[STATUS_CODE] AS NVARCHAR(255))\t\t\t\t\t\t\tAS [Order Line Status]\r\n\t,\t\t\tCAST(ISNULL(sol.[ORDERED_QTY],0) AS NVARCHAR(255))\t\t\t\t\tAS [Ordered Qty]\r\n\t,\t\t\tCAST(sol.[ORDERED_UOM] AS NVARCHAR(255))\t\t\t\t\t\t\tAS [Ordered UOM]\r\n\t,\t\t\tCAST(sol.[EXTENDED_AMOUNT] AS NVARCHAR(255))\t\t\t\t\t\tAS [Extended Amount]\r\n\t,\t\t\tCAST(sol.[INVENTORY_ITEM_ID] AS NVARCHAR(255))\t\t\t\t\t\tAS [Inventory Item ID]\r\n\t,\t\t\tCAST(sol.[UNIT_LIST_PRICE] AS NVARCHAR(255))\t\t\t\t\t\tAS [Unit List Price]\r\n\t,\t\t\tCAST(sol.[UNIT_SELLING_PRICE] AS NVARCHAR(255))\t\t\t\t\tAS [Unit Selling Price]\r\n\t,\t\t\tCAST(sol.[REFERENCE_LINE_ID] AS NVARCHAR(255))\t\t\t\t\t\tAS [Reference Line ID]\r\n\t,\t\t\tCAST(sol.[INVENTORY_ORGANIZATION_ID] AS NVARCHAR(255))\t\t\t\tAS [Inventory Organization ID]\r\n\t,\t\t\tCAST(sol.[DISPLAY_LINE_NUMBER]\t AS NVARCHAR(255))\t\t\t\tAS [Display Line Number]\r\n\t,\t\t\tCAST(sol.[SCHEDULE_SHIP_DATE] AS NVARCHAR(255))\t\t\t\t\tAS [Schedule Ship Date]\r\n\t,\t\t\tCAST(sol.[RMA_DELIVERED_QTY] AS NVARCHAR(255))\t\t\t\t\t\tAS [RMA Delivered Qty]\r\n\t,\t\t\tCAST(sol.[CANCELED_QTY]\t AS NVARCHAR(255))\t\t\t\t\t\tAS [Canceled Qty]\r\n\t,\t\t\tCAST(GETDATE() AS DATE)\t\t\t\t\t\tAS [DateStamp]\r\n\tINTO\t\t[Core].[SalesOrders]\r\n\tFROM\t\t[RAW].[O.DOO_HEADERS_ALL] soh\r\n\tLEFT JOIN\t[RAW].[O.DOO_LINES_ALL] sol\r\n\tON\t\t\tsoh.[HEADER_ID] = sol.[HEADER_ID]\r\n\tWHERE\t\tsoh.[STATUS_CODE] <> 'DOO_REFERENCE'\r\n\r\n\r\n/********************************************************************************************************\r\n\tStep 1.2\tCreate core invoice tables\r\n********************************************************************************************************/\r\n\r\n\tIF OBJECT_ID('[Core].[APInvoices]','U') IS NOT NULL\r\n\t\tDROP TABLE [Core].[APInvoices]\r\n\r\n\r\n\tSELECT\t\tCAST(apa.[INVOICE_ID] AS NVARCHAR(255))\t\t\t\t\t\tAS [Invoice ID]\r\n\t,\t\t\tCAST(apa.[PARTY_ID] AS NVARCHAR(255))\t\t\t\t\t\t\tAS [Party ID]\r\n\t,\t\t\tCAST(apa.[VENDOR_ID] AS NVARCHAR(255))\t\t\t\t\t\t\tAS [Vendor ID]\r\n\t,\t\t\tCAST(apa.[INVOICE_NUM] AS NVARCHAR(255))\t\t\t\t\t\tAS [Invoice Number]\r\n\t,\t\t\tCAST(apa.[SET_OF_BOOKS_ID]\t AS NVARCHAR(255))\t\t\t\tAS [Set of Books ID]\r\n\t,\t\t\tCAST(apa.[INVOICE_CURRENCY_CODE] AS NVARCHAR(255))\t\t\t\tAS [Invoice Currency Code]\r\n\t,\t\t\tCAST(apa.[INVOICE_AMOUNT] AS NVARCHAR(255))\t\t\t\t\tAS [Invoice Amount]\r\n\t,\t\t\tCAST(apa.[VENDOR_SITE_ID] AS NVARCHAR(255))\t\t\t\t\tAS [Vendor Site ID]\r\n\t,\t\t\tCAST(apa.[INVOICE_DATE] AS NVARCHAR(255))\t\t\t\t\t\tAS [Invoice Date]\r\n\t,\t\t\tCAST(apa.[INVOICE_TYPE_LOOKUP_CODE]\t AS NVARCHAR(255))\t\tAS [Invoice Type Lookup Code]\r\n\t,\t\t\tCAST(apa.[TERMS_ID] AS NVARCHAR(255))\t\t\t\t\t\t\tAS [Terms ID]\r\n\t,\t\t\tCAST(apa.[PAYMENT_STATUS_FLAG] AS NVARCHAR(255))\t\t\t\tAS [Payment Status Flag]\r\n\t,\t\t\tCAST(apa.[APPROVAL_STATUS] AS NVARCHAR(255))\t\t\t\t\tAS [Approval Status]\r\n\t,\t\t\tCAST(apa.[ORG_ID] AS NVARCHAR(255))\t\t\t\t\t\t\tAS [Org ID]\r\n\t,\t\t\tCAST(apa.[WFAPPROVAL_STATUS] AS NVARCHAR(255))\t\t\t\t\tAS [Workflow Approval Status]\r\n\t,\t\t\tCAST(apa.[LEGAL_ENTITY_ID] AS NVARCHAR(255))\t\t\t\t\tAS [Legal Entity ID]\r\n\t,\t\t\tCAST(apa.[PAYMENT_METHOD_CODE] AS NVARCHAR(255))\t\t\t\tAS [Payment Method Code]\r\n\t,\t\t\tCAST(apa.[PARTY_SITE_ID] AS NVARCHAR(255))\t\t\t\t\t\tAS [Party Site ID]\r\n\t,\t\t\tCAST(apa.[PAY_PROC_TRXN_TYPE_CODE] AS NVARCHAR(255))\t\t\tAS [Invoice Document Type]\r\n\t,\t\t\tCAST(apa.[DESCRIPTION] AS NVARCHAR(255))\t\t\t\t\t\tAS [Description]\r\n\t,\t\t\tCAST(apa.[AMOUNT_PAID] AS NVARCHAR(255))\t\t\t\t\t\tAS [Amount Paid]\r\n\t,\t\t\tCAST(apa.[EXCHANGE_RATE] AS NVARCHAR(255))\t\t\t\t\t\tAS [Exchange Rate]\r\n\t,\t\t\tCAST(apa.[TOTAL_TAX_AMOUNT]\t AS NVARCHAR(255))\t\t\t\tAS [Total Tax Amount]\r\n\t,\t\t\tCAST(apa.[PO_HEADER_ID] AS NVARCHAR(255))\t\t\t\t\t\tAS [PO Header ID]\r\n\t,\t\t\tCAST(apl.[LINE_NUMBER] AS NVARCHAR(255))\t\t\t\t\t\tAS [Line Number]\r\n\t,\t\t\tCAST(apl.[DESCRIPTION] AS NVARCHAR(255))\t\t\t\t\t\tAS [Invoice Line Description]\r\n\t,\t\t\tCAST(apl.[LINE_TYPE_LOOKUP_CODE] AS NVARCHAR(255))\t\t\t\tAS [Line Type Lookup Code]\r\n\t,\t\t\tCAST(apl.[AMOUNT] AS NVARCHAR(255))\t\t\t\t\t\t\tAS [Invoice Line Amount]\r\n\t,\t\t\tCAST(apl.[CANCELLED_FLAG] AS NVARCHAR(255))\t\t\t\t\tAS [Canelled Flag]\r\n\t,\t\t\tCAST(apl.[TAX_RATE_CODE] AS NVARCHAR(255))\t\t\t\t\t\tAS [Tax Rate Code]\r\n\t,\t\t\tCAST(apl.[TAX_RATE]\t AS NVARCHAR(255))\t\t\t\t\t\tAS [Tax Rate]\r\n\t,\t\t\tCAST(apl.[REQUESTER_ID] AS NVARCHAR(255))\t\t\t\t\t\tAS [Requester ID]\r\n\t,\t\t\tCAST(apl.[ITEM_DESCRIPTION] AS NVARCHAR(255))\t\t\t\t\tAS [Invoice Line Item Description]\r\n\t,\t\t\tCAST(apl.[QUANTITY_INVOICED] AS NVARCHAR(255))\t\t\t\t\tAS [Quantity Invoiced]\r\n\t,\t\t\tCAST(apl.[UNIT_MEAS_LOOKUP_CODE] AS NVARCHAR(255))\t\t\t\tAS [UOM Code]\r\n\t,\t\t\tCAST(apl.[UNIT_PRICE] AS NVARCHAR(255))\t\t\t\t\t\tAS [Unit Price]\r\n\t,\t\t\tCAST(apl.[PO_LINE_ID] AS NVARCHAR(255))\t\t\t\t\t\tAS [PO Line ID]\r\n\t,\t\t\tCAST(apl.[PO_LINE_LOCATION_ID] AS NVARCHAR(255))\t\t\t\tAS [PO Line Location ID]\r\n\t,\t\t\tCAST(apl.[PURCHASING_CATEGORY_ID] AS NVARCHAR(255))\t\t\tAS [Purchasing Category ID]\r\n\t,\t\t\tCAST(apl.[SHIP_TO_LOCATION_ID] AS NVARCHAR(255))\t\t\t\tAS [Ship to Location ID]\r\n\t,\t\t\tCAST(apl.[INVENTORY_ITEM_ID] AS NVARCHAR(255))\t\t\t\t\tAS [Inventory Item ID]\r\n\t,\t\t\tCAST(apl.[RCV_TRANSACTION_ID] AS NVARCHAR(255))\t\t\t\tAS [Receiving Transaction ID]\r\n\t,\t\t\tCAST(apl.[RCV_SHIPMENT_LINE_ID] AS NVARCHAR(255))\t\t\t\tAS [Receiving Shipment Line ID]\r\n\t,\t\t\tCAST(apl.[SHIP_FROM_LOCATION_ID] AS NVARCHAR(255))\t\t\t\tAS [Ship From Location ID]\r\n\t,\t\t\tCAST(GETDATE() AS DATE)\t\t\t\t\t\tAS [DateStamp]\r\n\tINTO\t\t[Core].[APInvoices]\r\n\tFROM\t\t[RAW].[O.AP_INVOICES_ALL] apa\r\n\tLEFT JOIN\t[RAW].[O.AP_INVOICE_LINES_ALL] apl\r\n\tON\t\t\tapa.[INVOICE_ID] = apl.[INVOICE_ID]\r\n\r\n\r\n\r\n\tIF OBJECT_ID('[Core].[ARInvoices]','U') IS NOT NULL\r\n\t\tDROP TABLE [Core].[ARInvoices]\r\n\r\n\tSELECT\t\tara.*\r\n\t,\t\t\tCAST(arl.[CUSTOMER_TRX_LINE_ID] AS NVARCHAR(255))\t\tAS [CUSTOMER_TRX_LINE_ID]\r\n\t,\t\t\tCAST(arl.[LINE_NUMBER] AS NVARCHAR(255))\t\t\t\tAS [LINE_NUMBER]\r\n\t,\t\t\tCAST(arl.[LINE_TYPE] AS NVARCHAR(255))\t\t\t\t\tAS [LINE_TYPE]\r\n\t,\t\t\tCAST(arl.[EXTENDED_AMOUNT] AS NVARCHAR(255))\t\t\tAS [EXTENDED_AMOUNT]\r\n\t,\t\t\tCAST(arl.[QUANTITY_INVOICED] AS NVARCHAR(255))\t\t\tAS [QUANTITY_INVOICED]\r\n\t,\t\t\tCAST(CAST(arl.[UNIT_SELLING_PRICE] AS FLOAT) AS DECIMAL(28,8)) AS [UNIT_SELLING_PRICE]\r\n\t,\t\t\tCAST(arl.[REVENUE_AMOUNT] AS NVARCHAR(255))\t\t\t\tAS [REVENUE_AMOUNT]\r\n\t,\t\t\tCAST(arl.[QUANTITY_ORDERED] AS NVARCHAR(255))\t\t\tAS [QUANTITY_ORDERED]\r\n\t,\t\t\tCAST(arl.[SALES_ORDER] AS NVARCHAR(255))\t\t\t\tAS [SALES_ORDER]\r\n\t,\t\t\tCAST(arl.[SALES_ORDER_LINE] AS NVARCHAR(255))\t\t\tAS [SALES_ORDER_LINE]\r\n\t,\t\t\tCAST(arl.[UOM_CODE] AS NVARCHAR(255))\t\t\t\t\tAS [UOM_CODE]\r\n\t,\t\t\tCAST(CAST(arl.[QUANTITY_CREDITED] AS FLOAT) AS DECIMAL(28,4))\t\tAS [Quantity Credited]\r\n\t,\t\t\tCAST(CAST(arl.[QUANTITY_INVOICED] AS FLOAT) AS DECIMAL(28,4))\t\tAS [Line Quantity Invoiced]\r\n\t,\t\t\tCAST(GETDATE() AS DATE)\t\t\t\t\t\tAS [DateStamp]\r\n\tINTO\t\t[Core].[ARInvoices]\r\n\tFROM\t\t[RAW].[O.RA_CUSTOMER_TRX_ALL] ara\r\n\tLEFT JOIN\t[RAW].[O.RA_CUSTOMER_TRX_LINES_ALL] arl\r\n\tON\t\t\tara.[CUSTOMER_TRX_ID] = arl.[CUSTOMER_TRX_ID]\r\n\r\n\t\r\n\r\n/********************************************************************************************************\r\n\tStep 1.3\tCreate core Inventory Transactions table.\r\n********************************************************************************************************/\r\n\r\n\r\n\tIF OBJECT_ID('[Core].[InventoryTransactions]','U') IS NOT NULL\r\n\t\tDROP TABLE [Core].[InventoryTransactions]\r\n\r\n\r\n\tSELECT\t\tCAST(imt.[TRANSACTION_ID] AS NVARCHAR(255))\t\t\t\t\tAS [TRANSACTION_ID]\r\n\t,\t\t\tCAST(imt.[LAST_UPDATED_BY] AS NVARCHAR(255))\t\t\t\tAS [LAST_UPDATED_BY]\r\n\t,\t\t\tCAST(imt.[CREATION_DATE] AS NVARCHAR(255))\t\t\t\t\tAS [CREATION_DATE]\r\n\t,\t\t\tCAST(imt.[INVENTORY_ITEM_ID] AS NVARCHAR(255))\t\t\t\tAS [INVENTORY_ITEM_ID]\r\n\t,\t\t\tCAST(imt.[ORGANIZATION_ID] AS NVARCHAR(255))\t\t\t\tAS [ORGANIZATION_ID]\r\n\t,\t\t\tCAST(imt.[SUBINVENTORY_CODE] AS NVARCHAR(255))\t\t\t\tAS [SUBINVENTORY_CODE]\r\n\t,\t\t\tCAST(imt.[TRANSACTION_TYPE_ID] AS NVARCHAR(255))\t\t\tAS [TRANSACTION_TYPE_ID]\r\n\t,\t\t\tCAST(imt.[TRANSACTION_ACTION_ID] AS NVARCHAR(255))\t\t\tAS [TRANSACTION_ACTION_ID]\r\n\t,\t\t\tCAST(imt.[TRANSACTION_SOURCE_TYPE_ID] AS NVARCHAR(255))\t\tAS [TRANSACTION_SOURCE_TYPE_ID]\r\n\t,\t\t\tCAST(imt.[PRIMARY_QUANTITY] AS NUMERIC(28,8))\tAS [Primary Quantity]\r\n\t,\t\t\tCAST(imt.[TRANSACTION_DATE] AS NVARCHAR(255))\t\t\t\t\t\t\tAS [TRANSACTION_DATE]\r\n\t,\t\t\tCAST(imt.[REASON_ID] AS NVARCHAR(255))\t\t\t\t\t\t\t\t\tAS [REASON_ID]\r\n\t,\t\t\tCAST(imt.[TRANSACTION_SET_ID] AS NVARCHAR(255))\t\t\t\t\t\tAS [TRANSACTION_SET_ID]\r\n\t,\t\t\tCAST(imt.[SOURCE_LINE_ID] AS NVARCHAR(255))\t\t\t\t\t\t\tAS [SOURCE_LINE_ID]\r\n\t,\t\t\tCAST(imt.[XFR_OWNING_ORGANIZATION_ID] AS NVARCHAR(255))\t\t\t\tAS [XFR_OWNING_ORGANIZATION_ID]\r\n\t,\t\t\tCAST(imt.[TRANSACTION_SOURCE_ID] AS NVARCHAR(255))\t\t\t\t\t\tAS [TRANSACTION_SOURCE_ID]\r\n\t,\t\t\tCAST(imt.[TRANSACTION_SOURCE_NAME] AS NVARCHAR(255))\t\t\t\t\tAS [TRANSACTION_SOURCE_NAME]\r\n\t,\t\t\tCAST(imt.[TRANSACTION_REFERENCE] AS NVARCHAR(255))\t\t\t\t\t\tAS [TRANSACTION_REFERENCE]\r\n\t,\t\t\tCAST(imt.[RCV_TRANSACTION_ID] AS NVARCHAR(255))\t\t\t\t\t\tAS [RCV_TRANSACTION_ID]\r\n\t,\t\t\tCAST(imt.[TRX_SOURCE_LINE_ID] AS NVARCHAR(255))\t\t\t\t\t\tAS [TRX_SOURCE_LINE_ID]\r\n\t,\t\t\tCAST(imt.[TRANSFER_TRANSACTION_ID] AS NVARCHAR(255))\t\t\t\t\tAS [TRANSFER_TRANSACTION_ID]\r\n\t,\t\t\tCAST(imt.[TRANSFER_ORGANIZATION_ID] AS NVARCHAR(255))\t\t\t\t\tAS [TRANSFER_ORGANIZATION_ID]\r\n\t,\t\t\tCAST(imt.[TRANSFER_SUBINVENTORY] AS NVARCHAR(255))\t\t\t\t\t\tAS [TRANSFER_SUBINVENTORY]\r\n\t,\t\t\tCAST(imt.[MOVE_ORDER_LINE_ID] AS NVARCHAR(255))\t\t\t\t\t\tAS [MOVE_ORDER_LINE_ID]\r\n\t,\t\t\tCAST(imt.[PICK_SLIP_NUMBER]\t AS NVARCHAR(255))\t\t\t\t\t\tAS [PICK_SLIP_NUMBER]\r\n\t,\t\t\tCAST(imt.[PICK_SLIP_LINE_NUMBER] AS NVARCHAR(255))\t\t\t\t\t\tAS [PICK_SLIP_LINE_NUMBER]\r\n\t,\t\t\tCAST(imt.[ORIG_SUBINVENTORY_CODE] AS NVARCHAR(255))\t\t\t\t\tAS [ORIG_SUBINVENTORY_CODE]\r\n\t,\t\t\tCAST(imt.[SHIPMENT_NUMBER] AS NVARCHAR(255))\t\t\t\t\t\t\tAS [SHIPMENT_NUMBER]\r\n\t,\t\t\tCAST(imt.[ATTRIBUTE1]\t AS NVARCHAR(255))\t\t\t\t\t\t\tAS [ATTRIBUTE1]\r\n\t,\t\t\tCAST(imt.[PICKING_LINE_ID] AS NVARCHAR(255))\t\t\t\t\t\t\tAS [PICKING_LINE_ID]\r\n\t,\t\t\tCAST(imt.[TRX_SOURCE_DELIVERY_ID] AS NVARCHAR(255))\t\t\t\t\tAS [TRX_SOURCE_DELIVERY_ID]\r\n\t,\t\t\tCAST(imt.[SHIP_TO_LOCATION_ID] AS NVARCHAR(255))\t\t\t\t\t\tAS [SHIP_TO_LOCATION_ID]\r\n\t,\t\t\tCAST(itt.[LANGUAGE] AS NVARCHAR(255))\t\t\t\t\t\t\t\t\tAS [LANGUAGE]\r\n\t,\t\t\tCAST(itt.[TRANSACTION_TYPE_NAME] AS NVARCHAR(255))\t\t\t\t\t\tAS [TRANSACTION_TYPE_NAME]\r\n\t,\t\t\tCAST(itrl.[LINE_ID]\t AS NVARCHAR(255))\t\t\t\t\t\t\t\tAS [LINE_ID]\r\n\t,\t\t\tCAST(itrl.[HEADER_ID]\t AS NVARCHAR(255))\t\t\t\t\t\t\tAS [HEADER_ID]\r\n\t,\t\t\tCAST(itrl.[LINE_NUMBER]\t AS NVARCHAR(255))\t\t\t\t\t\t\tAS [LINE_NUMBER]\r\n\t,\t\t\tCAST(itrl.[FROM_SUBINVENTORY_CODE] AS NVARCHAR(255))\t\t\t\t\tAS [FROM_SUBINVENTORY_CODE]\r\n\t,\t\t\tCAST(itrl.[UOM_CODE] AS NVARCHAR(255))\t\t\t\t\t\t\t\t\tAS [UOM_CODE]\r\n\t,\t\t\tCAST(itrl.[QUANTITY] AS NVARCHAR(255))\t\t\t\t\t\t\t\t\tAS [QUANTITY]\r\n\t,\t\t\tCAST(itrl.[DATE_REQUIRED] AS NVARCHAR(255))\t\t\t\t\t\t\tAS [DATE_REQUIRED]\r\n\t,\t\t\tCAST(itrl.[LINE_STATUS] AS NVARCHAR(255))\t\t\t\t\t\t\t\tAS [LINE_STATUS]\r\n\t,\t\t\tCAST(itrl.[QUANTITY_DELIVERED] AS NVARCHAR(255))\t\t\t\t\t\tAS [QUANTITY_DELIVERED]\r\n\t,\t\t\tCAST(itrl.[TO_SUBINVENTORY_CODE] AS NVARCHAR(255))\t\t\t\t\t\tAS [TO_SUBINVENTORY_CODE]\r\n\t,\t\t\tCAST(itrl.[REQUEST_ID] AS NVARCHAR(255))\t\t\t\t\t\t\t\tAS [REQUEST_ID]\r\n\t,\t\t\tCAST(itrl.[ATTRIBUTE_TIMESTAMP1] AS NVARCHAR(255))\t\t\t\t\t\tAS [ATTRIBUTE_TIMESTAMP1]\r\n\t,\t\t\tCAST(itrl.[TRANSACTION_HEADER_ID] AS NVARCHAR(255))\t\t\t\t\tAS [TRANSACTION_HEADER_ID]\r\n\t,\t\t\tCAST(itrl.[ATTRIBUTE2] AS NVARCHAR(255))\t\t\t\t\t\t\t\tAS [ATTRIBUTE2]\r\n\t,\t\t\tCAST(itrl.[ATTRIBUTE_NUMBER4] AS NVARCHAR(255))\t\t\t\t\t\tAS [ATTRIBUTE_NUMBER4]\r\n\t,\t\t\tCAST(itrl.[ATTRIBUTE_NUMBER5] AS NVARCHAR(255))\t\t\t\t\t\tAS [ATTRIBUTE_NUMBER5]\r\n\t,\t\t\tCAST(itrl.[ATTRIBUTE_NUMBER6] AS NVARCHAR(255))\t\t\t\t\t\tAS [ATTRIBUTE_NUMBER6]\r\n\t,\t\t\tCAST(itrl.[ATTRIBUTE_TIMESTAMP2] AS NVARCHAR(255))\t\t\t\t\t\tAS [ATTRIBUTE_TIMESTAMP2]\r\n\t,\t\t\tCAST(itrl.[REFERENCE_NAME] AS NVARCHAR(255))\t\t\t\t\t\t\tAS [REFERENCE_NAME]\r\n\t,\t\t\tCAST(GETDATE() AS DATE)\t\t\t\t\t\tAS [DateStamp]\r\n\tINTO\t\t[Core].[InventoryTransactions]\r\n\tFROM\t\t[RAW].[O.INV_MATERIAL_TXNS] imt\r\n\tLEFT JOIN\t[RAW].[O.INV_TRANSACTION_TYPES_TL] itt\r\n\tON\t\t\titt.[TRANSACTION_TYPE_ID] = imt.[TRANSACTION_TYPE_ID]\t\r\n\tLEFT JOIN\t[RAW].[O.INV_TXN_REQUEST_LINES] itrl\r\n\tON\t\t\titrl.[LINE_ID] = imt.[MOVE_ORDER_LINE_ID]\r\n\r\n\r\n/********************************************************************************************************\r\n\tStep 1.4\tCreate core shipping details table.\r\n********************************************************************************************************/\r\n\t\r\n\tIF OBJECT_ID('[Core].[ShippingDetails]','U') IS NOT NULL\r\n\t\tDROP TABLE [Core].[ShippingDetails]\r\n\r\n\tSELECT\t\t*\r\n\t,\t\t\tCAST(GETDATE() AS DATE)\t\t\t\t\t\tAS [DateStamp]\r\n\tINTO\t\t[Core].[ShippingDetails]\r\n\tFROM\t\t[RAW].[O.WSH_DELIVERY_DETAILS]\r\n\r\n/********************************************************************************************************\r\n\tStep 1.5\tCreate core inventory lot number tables.\r\n********************************************************************************************************/\r\n\r\n\tIF OBJECT_ID('[Core].[InventoryLotNumbers]','U') IS NOT NULL\r\n\t\tDROP TABLE [Core].[InventoryLotNumbers]\r\n\r\n\tSELECT\t\t*\r\n\t,\t\t\tCAST(GETDATE() AS DATE)\t\t\t\t\t\tAS [DateStamp]\r\n\tINTO\t\t[Core].[InventoryLotNumbers]\r\n\tFROM\t\t[RAW].[O.INV_LOT_NUMBERS]\r\n\r\n\r\n\r\n\tIF OBJECT_ID('[Core].[InventoryLotNumberTransactions]','U') IS NOT NULL\r\n\t\tDROP TABLE [Core].[InventoryLotNumberTransactions]\r\n\r\n\tSELECT\t\t*\r\n\t,\t\t\tCAST(GETDATE() AS DATE)\t\t\t\t\t\tAS [DateStamp]\r\n\tINTO\t\t[Core].[InventoryLotNumberTransactions]\r\n\tFROM\t\t[RAW].[O.INV_TRANSACTION_LOT_NUMBERS]\r\n\r\n/********************************************************************************************************\r\n\tStep 1.6\tCreate core receiving shipment headers table.\r\n********************************************************************************************************/\r\n\r\n\tIF OBJECT_ID('[Core].[ReceivingShipmentHeaders]','U') IS NOT NULL\r\n\t\tDROP TABLE [Core].[ReceivingShipmentHeaders]\r\n\r\n\tSELECT\t\t*\r\n\t,\t\t\tCAST(GETDATE() AS DATE)\t\t\t\t\t\tAS [DateStamp]\r\n\tINTO\t\t[Core].[ReceivingShipmentHeaders]\r\n\tFROM\t\t[RAW].[O.RCV_SHIPMENT_HEADERS]"
						}
					]
				}
			}
		],
		"folder": {
			"name": "Trade/Margin"
		},
		"annotations": [],
		"lastPublishTime": "2022-11-17T12:13:48Z"
	},
	"type": "Microsoft.DataFactory/factories/pipelines"
}